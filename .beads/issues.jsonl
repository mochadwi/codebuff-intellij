{"id":"cb-0jl","title":"Phase 3: Context Collection","description":"## Overview\nImplement the ContextCollector service that gathers editor selection, files, diagnostics, and git diff to send as context with user prompts.\n\n## Goals\n- Collect current editor selection with file path and line numbers\n- Collect entire file contents on demand\n- Gather IntelliJ diagnostics/inspections for touched files\n- Optional: collect git diff for uncommitted changes\n- UI for managing context attachments (add/remove)\n\n## Success Criteria\n- User can attach current selection to prompt\n- User can attach entire files to prompt\n- Context attachments visible in UI with remove option\n- Payload size limits enforced (cap file size)\n- Backend receives structured context objects\n\n## Technical Scope\n\n### Context Types\n```kotlin\nsealed class ContextItem {\n    data class Selection(\n        val path: String,\n        val content: String,\n        val startLine: Int,\n        val endLine: Int,\n        val language: String\n    ) : ContextItem()\n    \n    data class File(\n        val path: String,\n        val content: String,\n        val language: String\n    ) : ContextItem()\n    \n    data class Diagnostic(\n        val path: String,\n        val line: Int,\n        val severity: String,\n        val message: String\n    ) : ContextItem()\n    \n    data class GitDiff(\n        val diff: String\n    ) : ContextItem()\n}\n```\n\n### IntelliJ APIs\n- `Editor.getSelectionModel()` for selection\n- `PsiFile` / `VirtualFile` for file contents\n- `DaemonCodeAnalyzer` / `HighlightInfo` for diagnostics\n- `GitRepositoryManager` for git operations\n\n### UI\n- ContextAttachmentsPanel showing list of attached items\n- Click to remove attachment\n- File size indicator\n\n## Effort Estimate\nM (3-4 days)\n\n## Reference\n- [OpenCode_UI SessionManager](https://github.com/LaiZhou/OpenCode_UI/blob/main/src/main/kotlin/ai/opencode/ide/jetbrains/session/SessionManager.kt)","status":"open","priority":1,"issue_type":"epic","owner":"moch.iqbaldc@gmail.com","created_at":"2026-01-24T01:59:29.737391+07:00","created_by":"mochadwi","updated_at":"2026-01-24T01:59:29.737391+07:00","labels":["context","epic","phase-3"],"dependencies":[{"issue_id":"cb-0jl","depends_on_id":"cb-ble","type":"blocks","created_at":"2026-01-24T09:26:37.426569+07:00","created_by":"mochadwi"}]}
{"id":"cb-0jl.1","title":"Implement ContextCollector service","description":"Core service for collecting editor context.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/services/ContextCollector.kt\n- src/main/kotlin/com/codebuff/intellij/model/ContextItem.kt\n\n## Implementation\n```kotlin\n@Service(Service.Level.PROJECT)\nclass ContextCollector(private val project: Project) {\n    \n    fun collectSelection(editor: Editor): ContextItem.Selection? {\n        val selectionModel = editor.selectionModel\n        if (!selectionModel.hasSelection()) return null\n        \n        val document = editor.document\n        val file = FileDocumentManager.getInstance().getFile(document)\n        val psiFile = file?.let { PsiManager.getInstance(project).findFile(it) }\n        \n        return ContextItem.Selection(\n            path = file?.let { getRelativePath(it) } ?: \"untitled\",\n            content = selectionModel.selectedText ?: \"\",\n            startLine = document.getLineNumber(selectionModel.selectionStart) + 1,\n            endLine = document.getLineNumber(selectionModel.selectionEnd) + 1,\n            language = psiFile?.language?.id ?: \"text\"\n        )\n    }\n    \n    fun collectFile(virtualFile: VirtualFile): ContextItem.File? {\n        if (virtualFile.length \u003e MAX_FILE_SIZE) return null\n        \n        val content = String(virtualFile.contentsToByteArray(), Charsets.UTF_8)\n        val psiFile = PsiManager.getInstance(project).findFile(virtualFile)\n        \n        return ContextItem.File(\n            path = getRelativePath(virtualFile),\n            content = content,\n            language = psiFile?.language?.id ?: \"text\"\n        )\n    }\n    \n    private fun getRelativePath(file: VirtualFile): String {\n        val basePath = project.basePath ?: return file.path\n        return file.path.removePrefix(basePath).removePrefix(\"/\")\n    }\n    \n    companion object {\n        const val MAX_FILE_SIZE = 1024 * 1024 // 1MB\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Selection collection works\n- [ ] File collection works with size limit\n- [ ] Language detection accurate\n- [ ] Paths are project-relative","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":150,"created_at":"2026-01-24T02:02:01.271951+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:02:01.271951+07:00","labels":["context","services"],"dependencies":[{"issue_id":"cb-0jl.1","depends_on_id":"cb-0jl","type":"parent-child","created_at":"2026-01-24T02:02:01.275312+07:00","created_by":"mochadwi"},{"issue_id":"cb-0jl.1","depends_on_id":"cb-0jl.6","type":"blocks","created_at":"2026-01-24T09:26:13.100506+07:00","created_by":"mochadwi"}]}
{"id":"cb-0jl.10","title":"Write tests for context to backend integration","description":"## TDD: Test First\n\nWrite tests for wiring context to backend requests.\n\n## Test Cases\n\n```kotlin\nclass ContextBackendIntegrationTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `sendMessage includes context in request`() {\n        val capturedRequest = slot\u003cSendMessageRequest\u003e()\n        val mockClient = mockk\u003cBackendClient\u003e {\n            coEvery { sendMessage(capture(capturedRequest)) } returns flowOf(DoneEvent(\"s1\"))\n        }\n        val service = CodebuffProjectService(project, mockClient)\n        val contextPanel = service.getContextPanel()\n        \n        contextPanel.addAttachment(ContextItem.File(\"test.kt\", \"code\", \"kotlin\"))\n        \n        runBlocking { service.sendMessage(\"do something\") }\n        \n        assertEquals(1, capturedRequest.captured.context.size)\n    }\n    \n    @Test\n    fun `context cleared after send`() {\n        val mockClient = mockk\u003cBackendClient\u003e(relaxed = true)\n        val service = CodebuffProjectService(project, mockClient)\n        val contextPanel = service.getContextPanel()\n        \n        contextPanel.addAttachment(ContextItem.File(\"test.kt\", \"code\", \"kotlin\"))\n        \n        runBlocking { service.sendMessage(\"do something\") }\n        \n        assertTrue(contextPanel.getAttachments().isEmpty())\n    }\n    \n    @Test\n    fun `context serializes correctly`() {\n        val file = ContextItem.File(\"test.kt\", \"content\", \"kotlin\")\n        \n        val json = file.toProtocol()\n        \n        assertEquals(\"file\", json.get(\"type\").asString)\n        assertEquals(\"test.kt\", json.get(\"path\").asString)\n        assertEquals(\"content\", json.get(\"content\").asString)\n    }\n    \n    @Test\n    fun `selection context includes line numbers`() {\n        val selection = ContextItem.Selection(\n            path = \"test.kt\",\n            content = \"code\",\n            startLine = 10,\n            endLine = 15,\n            language = \"kotlin\"\n        )\n        \n        val json = selection.toProtocol()\n        \n        assertEquals(10, json.get(\"startLine\").asInt)\n        assertEquals(15, json.get(\"endLine\").asInt)\n    }\n    \n    @Test\n    fun `large context is chunked`() {\n        val largeContent = \"x\".repeat(500_000)\n        val file = ContextItem.File(\"large.txt\", largeContent, \"text\")\n        \n        val chunks = file.toChunkedProtocol(maxSize = 100_000)\n        \n        assertTrue(chunks.size \u003e 1)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Request includes context\n- [ ] Context serialization tests\n- [ ] Clear after send tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:23:20.30367+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:23:20.30367+07:00","labels":["context","integration","tdd","test"],"dependencies":[{"issue_id":"cb-0jl.10","depends_on_id":"cb-0jl","type":"parent-child","created_at":"2026-01-24T09:23:20.304369+07:00","created_by":"mochadwi"}]}
{"id":"cb-0jl.2","title":"Implement diagnostics collection","description":"Collect IntelliJ diagnostics/inspections for files.\n\n## Implementation\n```kotlin\nfun collectDiagnostics(file: VirtualFile): List\u003cContextItem.Diagnostic\u003e {\n    val psiFile = PsiManager.getInstance(project).findFile(file) ?: return emptyList()\n    val document = FileDocumentManager.getInstance().getDocument(file) ?: return emptyList()\n    \n    val highlightInfos = DaemonCodeAnalyzerImpl.getHighlights(\n        document, \n        HighlightSeverity.WARNING, \n        project\n    )\n    \n    return highlightInfos.mapNotNull { info -\u003e\n        if (info.severity.myVal \u003c HighlightSeverity.WARNING.myVal) return@mapNotNull null\n        \n        ContextItem.Diagnostic(\n            path = getRelativePath(file),\n            line = document.getLineNumber(info.startOffset) + 1,\n            severity = when {\n                info.severity == HighlightSeverity.ERROR -\u003e \"error\"\n                info.severity == HighlightSeverity.WARNING -\u003e \"warning\"\n                else -\u003e \"info\"\n            },\n            message = info.description ?: \"\"\n        )\n    }\n}\n```\n\n## Considerations\n- Only collect from open files (already analyzed)\n- Filter by severity (warning+)\n- Limit number of diagnostics per file\n\n## Acceptance Criteria\n- [ ] Errors collected correctly\n- [ ] Warnings collected correctly\n- [ ] Line numbers accurate\n- [ ] Performance acceptable","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":120,"created_at":"2026-01-24T02:02:01.364391+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:02:01.364391+07:00","labels":["context","diagnostics"],"dependencies":[{"issue_id":"cb-0jl.2","depends_on_id":"cb-0jl","type":"parent-child","created_at":"2026-01-24T02:02:01.365057+07:00","created_by":"mochadwi"},{"issue_id":"cb-0jl.2","depends_on_id":"cb-0jl.7","type":"blocks","created_at":"2026-01-24T09:26:13.159489+07:00","created_by":"mochadwi"}]}
{"id":"cb-0jl.3","title":"Implement git diff collection","description":"Collect git diff for uncommitted changes.\n\n## Implementation\n```kotlin\nfun collectGitDiff(): ContextItem.GitDiff? {\n    val repository = GitRepositoryManager.getInstance(project)\n        .repositories\n        .firstOrNull() ?: return null\n    \n    val handler = GitLineHandler(project, repository.root, GitCommand.DIFF)\n    handler.addParameters(\"--cached\", \"--no-color\")\n    \n    return try {\n        val output = Git.getInstance().runCommand(handler).getOutputOrThrow()\n        if (output.isBlank()) null\n        else ContextItem.GitDiff(diff = output)\n    } catch (e: Exception) {\n        null\n    }\n}\n```\n\n## Options\n- Staged changes only\n- All uncommitted changes\n- Diff against specific branch\n\n## Acceptance Criteria\n- [ ] Git diff collected when available\n- [ ] Graceful handling when not a git repo\n- [ ] Diff format readable\n- [ ] Performance acceptable","status":"open","priority":2,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T02:02:01.454687+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:02:01.454687+07:00","labels":["context","git"],"dependencies":[{"issue_id":"cb-0jl.3","depends_on_id":"cb-0jl","type":"parent-child","created_at":"2026-01-24T02:02:01.455404+07:00","created_by":"mochadwi"},{"issue_id":"cb-0jl.3","depends_on_id":"cb-0jl.8","type":"blocks","created_at":"2026-01-24T09:26:13.217909+07:00","created_by":"mochadwi"}]}
{"id":"cb-0jl.4","title":"Create ContextAttachmentsPanel UI","description":"UI component for displaying and managing context attachments.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/ui/ContextAttachmentsPanel.kt\n\n## Implementation\n```kotlin\nclass ContextAttachmentsPanel(private val project: Project) : JPanel(BorderLayout()) {\n    \n    private val attachments = mutableListOf\u003cContextItem\u003e()\n    private val listModel = DefaultListModel\u003cContextItem\u003e()\n    private val list = JBList(listModel)\n    \n    init {\n        border = IdeBorderFactory.createTitledBorder(\"Context\")\n        \n        list.cellRenderer = ContextItemRenderer()\n        list.addMouseListener(object : MouseAdapter() {\n            override fun mouseClicked(e: MouseEvent) {\n                if (SwingUtilities.isRightMouseButton(e)) {\n                    showContextMenu(e)\n                }\n            }\n        })\n        \n        add(JBScrollPane(list), BorderLayout.CENTER)\n        add(createToolbar(), BorderLayout.NORTH)\n    }\n    \n    private fun createToolbar(): JComponent {\n        val group = DefaultActionGroup().apply {\n            add(AddSelectionAction())\n            add(AddFileAction())\n            addSeparator()\n            add(ClearAllAction())\n        }\n        return ActionManager.getInstance()\n            .createActionToolbar(\"CodebuffContext\", group, true)\n            .component\n    }\n    \n    fun addAttachment(item: ContextItem) {\n        attachments.add(item)\n        listModel.addElement(item)\n    }\n    \n    fun getAttachments(): List\u003cContextItem\u003e = attachments.toList()\n    \n    fun clear() {\n        attachments.clear()\n        listModel.clear()\n    }\n}\n```\n\n## Features\n- List view of attachments\n- Add/remove actions\n- File size indicator\n- Click to preview content\n\n## Acceptance Criteria\n- [ ] Attachments display correctly\n- [ ] Add/remove works\n- [ ] File paths are readable\n- [ ] Clear all works","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":150,"created_at":"2026-01-24T02:02:01.539371+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:02:01.539371+07:00","labels":["context","ui"],"dependencies":[{"issue_id":"cb-0jl.4","depends_on_id":"cb-0jl","type":"parent-child","created_at":"2026-01-24T02:02:01.540051+07:00","created_by":"mochadwi"},{"issue_id":"cb-0jl.4","depends_on_id":"cb-0jl.9","type":"blocks","created_at":"2026-01-24T09:26:13.275438+07:00","created_by":"mochadwi"}]}
{"id":"cb-0jl.5","title":"Wire context collection to backend requests","description":"Include collected context in backend message requests.\n\n## Implementation\n```kotlin\n// In CodebuffProjectService\nfun sendMessage(text: String) {\n    val contextPanel = getContextPanel()\n    val context = contextPanel.getAttachments()\n    \n    val request = SendMessageRequest(\n        sessionId = sessionManager.activeSession?.id ?: createNewSession(),\n        text = text,\n        context = context.map { it.toProtocol() }\n    )\n    \n    scope.launch {\n        backendClient.sendMessage(request).collect { event -\u003e\n            eventRouter.routeEvent(event)\n        }\n    }\n    \n    // Clear context after sending\n    contextPanel.clear()\n}\n\n// Context serialization\nfun ContextItem.toProtocol(): JsonObject = when (this) {\n    is ContextItem.Selection -\u003e buildJsonObject {\n        put(\"type\", \"selection\")\n        put(\"path\", path)\n        put(\"content\", content)\n        put(\"startLine\", startLine)\n        put(\"endLine\", endLine)\n        put(\"language\", language)\n    }\n    is ContextItem.File -\u003e buildJsonObject {\n        put(\"type\", \"file\")\n        put(\"path\", path)\n        put(\"content\", content)\n        put(\"language\", language)\n    }\n    // ... other types\n}\n```\n\n## Acceptance Criteria\n- [ ] Context included in requests\n- [ ] Context cleared after send\n- [ ] Large contexts handled (chunking if needed)\n- [ ] Backend receives structured context","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T02:02:01.633768+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:02:01.633768+07:00","labels":["context","integration"],"dependencies":[{"issue_id":"cb-0jl.5","depends_on_id":"cb-0jl","type":"parent-child","created_at":"2026-01-24T02:02:01.634435+07:00","created_by":"mochadwi"},{"issue_id":"cb-0jl.5","depends_on_id":"cb-0jl.10","type":"blocks","created_at":"2026-01-24T09:26:13.335551+07:00","created_by":"mochadwi"}]}
{"id":"cb-0jl.6","title":"Write tests for ContextCollector service","description":"## TDD: Test First\n\nWrite tests for context collection before implementing.\n\n## Test Cases\n\n```kotlin\nclass ContextCollectorTest : BasePlatformTestCase() {\n    \n    private lateinit var collector: ContextCollector\n    \n    override fun setUp() {\n        super.setUp()\n        collector = project.service\u003cContextCollector\u003e()\n    }\n    \n    // Selection Collection Tests\n    \n    @Test\n    fun `collectSelection returns null when no selection`() {\n        val editor = createEditorWithContent(\"some code\")\n        \n        val result = collector.collectSelection(editor)\n        \n        assertNull(result)\n    }\n    \n    @Test\n    fun `collectSelection captures selected text`() {\n        val editor = createEditorWithContent(\"line1\\nline2\\nline3\")\n        editor.selectionModel.setSelection(6, 11) // \"line2\"\n        \n        val result = collector.collectSelection(editor)\n        \n        assertNotNull(result)\n        assertEquals(\"line2\", result!!.content)\n    }\n    \n    @Test\n    fun `collectSelection includes line numbers`() {\n        val editor = createEditorWithContent(\"line1\\nline2\\nline3\")\n        editor.selectionModel.setSelection(6, 11)\n        \n        val result = collector.collectSelection(editor)\n        \n        assertEquals(2, result!!.startLine)\n        assertEquals(2, result.endLine)\n    }\n    \n    @Test\n    fun `collectSelection detects language`() {\n        val file = myFixture.configureByText(\"Test.kt\", \"fun test() {}\")\n        val editor = myFixture.editor\n        editor.selectionModel.setSelection(0, 14)\n        \n        val result = collector.collectSelection(editor)\n        \n        assertEquals(\"kotlin\", result!!.language.lowercase())\n    }\n    \n    // File Collection Tests\n    \n    @Test\n    fun `collectFile returns file content`() {\n        val file = createVirtualFile(\"test.txt\", \"file content\")\n        \n        val result = collector.collectFile(file)\n        \n        assertNotNull(result)\n        assertEquals(\"file content\", result!!.content)\n    }\n    \n    @Test\n    fun `collectFile returns null for large files`() {\n        val largeContent = \"x\".repeat(2 * 1024 * 1024) // 2MB\n        val file = createVirtualFile(\"large.txt\", largeContent)\n        \n        val result = collector.collectFile(file)\n        \n        assertNull(result)\n    }\n    \n    @Test\n    fun `collectFile returns relative path`() {\n        val file = createVirtualFile(\"src/main/Test.kt\", \"code\")\n        \n        val result = collector.collectFile(file)\n        \n        assertEquals(\"src/main/Test.kt\", result!!.path)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Selection collection tests\n- [ ] File collection tests\n- [ ] Language detection tests\n- [ ] Size limit tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":120,"created_at":"2026-01-24T09:23:19.935924+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:23:19.935924+07:00","labels":["context","services","tdd","test"],"dependencies":[{"issue_id":"cb-0jl.6","depends_on_id":"cb-0jl","type":"parent-child","created_at":"2026-01-24T09:23:19.936656+07:00","created_by":"mochadwi"}]}
{"id":"cb-0jl.7","title":"Write tests for diagnostics collection","description":"## TDD: Test First\n\nWrite tests for diagnostics collection.\n\n## Test Cases\n\n```kotlin\nclass DiagnosticsCollectionTest : BasePlatformTestCase() {\n    \n    private lateinit var collector: ContextCollector\n    \n    override fun setUp() {\n        super.setUp()\n        collector = project.service\u003cContextCollector\u003e()\n    }\n    \n    @Test\n    fun `collectDiagnostics returns empty for valid file`() {\n        val file = myFixture.configureByText(\"Valid.kt\", \"fun valid() {}\")\n        myFixture.doHighlighting()\n        \n        val result = collector.collectDiagnostics(file.virtualFile)\n        \n        assertTrue(result.isEmpty())\n    }\n    \n    @Test\n    fun `collectDiagnostics captures errors`() {\n        val file = myFixture.configureByText(\"Error.kt\", \"fun error( {}\") // Syntax error\n        myFixture.doHighlighting()\n        \n        val result = collector.collectDiagnostics(file.virtualFile)\n        \n        assertTrue(result.any { it.severity == \"error\" })\n    }\n    \n    @Test\n    fun `collectDiagnostics includes line numbers`() {\n        val file = myFixture.configureByText(\"Error.kt\", \"line1\\nfun error( {}\\nline3\")\n        myFixture.doHighlighting()\n        \n        val result = collector.collectDiagnostics(file.virtualFile)\n        \n        assertTrue(result.any { it.line == 2 })\n    }\n    \n    @Test\n    fun `collectDiagnostics includes message`() {\n        val file = myFixture.configureByText(\"Error.kt\", \"undefined_function()\")\n        myFixture.doHighlighting()\n        \n        val result = collector.collectDiagnostics(file.virtualFile)\n        \n        assertTrue(result.any { it.message.isNotBlank() })\n    }\n    \n    @Test\n    fun `collectDiagnostics filters by severity`() {\n        // Configure file with both warning and error\n        val file = myFixture.configureByText(\"Mixed.kt\", \"\"\"\n            val unused = 1  // warning\n            undefined()     // error\n        \"\"\".trimIndent())\n        myFixture.doHighlighting()\n        \n        val result = collector.collectDiagnostics(file.virtualFile)\n        \n        // Should include warnings and errors\n        assertTrue(result.any { it.severity == \"warning\" || it.severity == \"error\" })\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Error detection tests\n- [ ] Line number accuracy tests\n- [ ] Severity filtering tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:23:20.027968+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:23:20.027968+07:00","labels":["context","diagnostics","tdd","test"],"dependencies":[{"issue_id":"cb-0jl.7","depends_on_id":"cb-0jl","type":"parent-child","created_at":"2026-01-24T09:23:20.028692+07:00","created_by":"mochadwi"}]}
{"id":"cb-0jl.8","title":"Write tests for git diff collection","description":"## TDD: Test First\n\nWrite tests for git diff collection.\n\n## Test Cases\n\n```kotlin\nclass GitDiffCollectionTest : BasePlatformTestCase() {\n    \n    private lateinit var collector: ContextCollector\n    \n    override fun setUp() {\n        super.setUp()\n        collector = project.service\u003cContextCollector\u003e()\n        initGitRepository()\n    }\n    \n    @Test\n    fun `collectGitDiff returns null when not git repo`() {\n        // Remove .git directory\n        removeGitDirectory()\n        \n        val result = collector.collectGitDiff()\n        \n        assertNull(result)\n    }\n    \n    @Test\n    fun `collectGitDiff returns null when no changes`() {\n        // Clean working tree\n        commitAllChanges()\n        \n        val result = collector.collectGitDiff()\n        \n        assertNull(result)\n    }\n    \n    @Test\n    fun `collectGitDiff captures uncommitted changes`() {\n        createFile(\"new.txt\", \"new content\")\n        stageFile(\"new.txt\")\n        \n        val result = collector.collectGitDiff()\n        \n        assertNotNull(result)\n        assertTrue(result!!.diff.contains(\"new content\"))\n    }\n    \n    @Test\n    fun `collectGitDiff shows unified diff format`() {\n        modifyFile(\"existing.txt\", \"modified\")\n        stageFile(\"existing.txt\")\n        \n        val result = collector.collectGitDiff()\n        \n        assertTrue(result!!.diff.contains(\"+++\"))\n        assertTrue(result.diff.contains(\"---\"))\n    }\n    \n    private fun initGitRepository() {\n        // Initialize git repo for test\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Non-git repo handling\n- [ ] No changes handling\n- [ ] Diff content tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":60,"created_at":"2026-01-24T09:23:20.119927+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:23:20.119927+07:00","labels":["context","git","tdd","test"],"dependencies":[{"issue_id":"cb-0jl.8","depends_on_id":"cb-0jl","type":"parent-child","created_at":"2026-01-24T09:23:20.120647+07:00","created_by":"mochadwi"}]}
{"id":"cb-0jl.9","title":"Write tests for ContextAttachmentsPanel UI","description":"## TDD: Test First\n\nWrite tests for context attachments panel.\n\n## Test Cases\n\n```kotlin\nclass ContextAttachmentsPanelTest : BasePlatformTestCase() {\n    \n    private lateinit var panel: ContextAttachmentsPanel\n    \n    override fun setUp() {\n        super.setUp()\n        panel = ContextAttachmentsPanel(project)\n    }\n    \n    @Test\n    fun `panel starts empty`() {\n        assertTrue(panel.getAttachments().isEmpty())\n    }\n    \n    @Test\n    fun `addAttachment adds item to list`() {\n        val item = ContextItem.File(\"test.kt\", \"content\", \"kotlin\")\n        \n        panel.addAttachment(item)\n        \n        assertEquals(1, panel.getAttachments().size)\n    }\n    \n    @Test\n    fun `addAttachment updates UI`() {\n        val item = ContextItem.File(\"test.kt\", \"content\", \"kotlin\")\n        \n        panel.addAttachment(item)\n        \n        val list = panel.findComponent\u003cJBList\u003c*\u003e\u003e()\n        assertEquals(1, list?.model?.size)\n    }\n    \n    @Test\n    fun `clear removes all attachments`() {\n        panel.addAttachment(ContextItem.File(\"a.kt\", \"c\", \"kotlin\"))\n        panel.addAttachment(ContextItem.File(\"b.kt\", \"c\", \"kotlin\"))\n        \n        panel.clear()\n        \n        assertTrue(panel.getAttachments().isEmpty())\n    }\n    \n    @Test\n    fun `selection displays file path`() {\n        val selection = ContextItem.Selection(\n            path = \"src/Main.kt\",\n            content = \"code\",\n            startLine = 10,\n            endLine = 20,\n            language = \"kotlin\"\n        )\n        panel.addAttachment(selection)\n        \n        val displayText = panel.getDisplayTextFor(0)\n        \n        assertTrue(displayText.contains(\"Main.kt\"))\n        assertTrue(displayText.contains(\"10-20\"))\n    }\n    \n    @Test\n    fun `toolbar has add and clear actions`() {\n        val toolbar = panel.findComponent\u003cActionToolbar\u003e()\n        \n        assertNotNull(toolbar)\n        // Verify actions exist\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Add/remove functionality tests\n- [ ] Display formatting tests\n- [ ] Toolbar action tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:23:20.208899+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:23:20.208899+07:00","labels":["context","tdd","test","ui"],"dependencies":[{"issue_id":"cb-0jl.9","depends_on_id":"cb-0jl","type":"parent-child","created_at":"2026-01-24T09:23:20.209585+07:00","created_by":"mochadwi"}]}
{"id":"cb-5zs","title":"Phase 6: Advanced Features \u0026 Parity","description":"## Overview\nImplement advanced features for parity with OpenCode_UI including terminal integration, tool call visibility, diagnostics integration, and optional REST/SSE backend.\n\n## Goals\n- Terminal integration for viewing backend logs\n- Tool call/result visibility in chat UI\n- Auto-include IDE diagnostics in context\n- Optional REST/SSE backend for cloud mode\n- Command palette integration\n\n## Success Criteria\n- Tool calls rendered inline in chat (collapsible)\n- Terminal shows backend trace logs\n- Diagnostics auto-attached when relevant\n- REST/SSE backend works as alternative\n- All keyboard shortcuts functional\n\n## Technical Scope\n\n### Terminal Integration\n- Dedicated terminal tab for Codebuff logs\n- Show tool traces when --trace enabled\n- Clickable file paths in terminal output\n\n### Tool Visibility\n```kotlin\n// Render tool calls in chat\nsealed class ChatMessage {\n    data class User(val text: String, val context: List\u003cContextItem\u003e) : ChatMessage()\n    data class Assistant(val text: String) : ChatMessage()\n    data class ToolCall(\n        val tool: String,\n        val input: JsonObject,\n        var result: JsonObject? = null,\n        var collapsed: Boolean = true\n    ) : ChatMessage()\n}\n```\n\n### Diagnostics Integration\n- Watch for HighlightInfo changes\n- Auto-suggest adding errors to context\n- \"Include diagnostics\" toggle in settings\n\n### REST/SSE Backend (Optional)\n```kotlin\ninterface BackendClient {\n    suspend fun connect()\n    suspend fun disconnect()\n    suspend fun sendMessage(request: MessageRequest): Flow\u003cBackendEvent\u003e\n    suspend fun cancel(sessionId: String)\n}\n\nclass RestBackendClient(\n    private val baseUrl: String,\n    private val apiKey: String\n) : BackendClient {\n    // OkHttp + SSE implementation\n}\n```\n\n### Command Palette\n- \"Codebuff: Ask about selection\"\n- \"Codebuff: New session\"\n- \"Codebuff: Review changes\"\n- Search actions via Cmd+Shift+A\n\n## Effort Estimate\nL (5-8 days)\n\n## Reference\n- [OpenCode_UI Terminal Integration](https://github.com/LaiZhou/OpenCode_UI/blob/main/src/main/kotlin/ai/opencode/ide/jetbrains/terminal/)\n- [OpenCode_UI Web Mode](https://github.com/LaiZhou/OpenCode_UI/blob/main/src/main/kotlin/ai/opencode/ide/jetbrains/web/)\n- [Codebuff API](https://codebuff.com/docs)","status":"open","priority":2,"issue_type":"epic","owner":"moch.iqbaldc@gmail.com","created_at":"2026-01-24T02:00:10.09339+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:00:10.09339+07:00","labels":["advanced","epic","phase-6"],"dependencies":[{"issue_id":"cb-5zs","depends_on_id":"cb-u20","type":"blocks","created_at":"2026-01-24T09:26:37.614879+07:00","created_by":"mochadwi"}]}
{"id":"cb-5zs.1","title":"Implement terminal integration for logs","description":"Dedicated terminal tab for viewing Codebuff backend logs and traces.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/terminal/CodebuffTerminalFactory.kt\n\n## Implementation\n```kotlin\nclass CodebuffTerminalFactory(private val project: Project) {\n    \n    fun createLogTerminal(): ShellTerminalWidget? {\n        val terminalView = TerminalView.getInstance(project)\n        \n        // Create a virtual terminal for log output\n        val widget = terminalView.createLocalShellWidget(\n            project.basePath ?: return null,\n            \"Codebuff Logs\"\n        )\n        \n        return widget\n    }\n    \n    fun writeToTerminal(widget: ShellTerminalWidget, text: String) {\n        // Write log output to terminal\n        widget.terminalStarter?.sendString(text)\n    }\n}\n\n// In StreamingEventRouter, forward events to terminal when trace enabled\nif (settings.traceEnabled) {\n    val logLine = when (event) {\n        is ToolCallEvent -\u003e \"[TOOL] ${event.tool}: ${event.input}\"\n        is ToolResultEvent -\u003e \"[RESULT] ${event.tool}: ${event.output}\"\n        is TokenEvent -\u003e null // Too noisy\n        else -\u003e \"[EVENT] $event\"\n    }\n    logLine?.let { terminalFactory.writeToTerminal(logWidget, it + \"\\n\") }\n}\n```\n\n## Features\n- Dedicated terminal tab named \"Codebuff Logs\"\n- Tool calls and results logged\n- Clickable file paths (using link filter)\n- Toggle via settings\n\n## Acceptance Criteria\n- [ ] Log terminal created successfully\n- [ ] Tool calls visible\n- [ ] File paths clickable\n- [ ] Can be toggled on/off","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":180,"created_at":"2026-01-24T02:04:26.025854+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:04:26.025854+07:00","labels":["logging","terminal"],"dependencies":[{"issue_id":"cb-5zs.1","depends_on_id":"cb-5zs","type":"parent-child","created_at":"2026-01-24T02:04:26.026571+07:00","created_by":"mochadwi"},{"issue_id":"cb-5zs.1","depends_on_id":"cb-5zs.7","type":"blocks","created_at":"2026-01-24T09:26:31.462957+07:00","created_by":"mochadwi"}]}
{"id":"cb-5zs.10","title":"Write tests for REST/SSE backend client","description":"## TDD: Test First\n\nWrite tests for REST/SSE backend client.\n\n## Test Cases\n\n```kotlin\nclass RestBackendClientTest : BasePlatformTestCase() {\n    \n    private lateinit var mockServer: MockWebServer\n    private lateinit var client: RestBackendClient\n    \n    override fun setUp() {\n        super.setUp()\n        mockServer = MockWebServer()\n        mockServer.start()\n        client = RestBackendClient(\n            project,\n            mockServer.url(\"/\").toString(),\n            \"test-api-key\"\n        )\n    }\n    \n    override fun tearDown() {\n        mockServer.shutdown()\n        super.tearDown()\n    }\n    \n    @Test\n    fun `sendMessage includes authorization header`() {\n        mockServer.enqueue(MockResponse()\n            .setBody(\"data: {\\\"type\\\":\\\"done\\\",\\\"sessionId\\\":\\\"s1\\\"}\\n\\n\"))\n        \n        runBlocking {\n            client.sendMessage(SendMessageRequest(\"id\", \"sendMessage\", \"s1\", \"test\"))\n                .collect {}\n        }\n        \n        val request = mockServer.takeRequest()\n        assertTrue(request.getHeader(\"Authorization\")?.startsWith(\"Bearer \") == true)\n    }\n    \n    @Test\n    fun `sendMessage uses correct endpoint`() {\n        mockServer.enqueue(MockResponse()\n            .setBody(\"data: {\\\"type\\\":\\\"done\\\",\\\"sessionId\\\":\\\"s1\\\"}\\n\\n\"))\n        \n        runBlocking {\n            client.sendMessage(SendMessageRequest(\"id\", \"sendMessage\", \"s1\", \"test\"))\n                .collect {}\n        }\n        \n        val request = mockServer.takeRequest()\n        assertTrue(request.path?.contains(\"/api/v1/sessions/s1/messages\") == true)\n    }\n    \n    @Test\n    fun `parses SSE token events`() {\n        mockServer.enqueue(MockResponse()\n            .setBody(\"data: {\\\"type\\\":\\\"token\\\",\\\"sessionId\\\":\\\"s1\\\",\\\"text\\\":\\\"Hello\\\"}\\n\\n\"))\n        \n        val events = mutableListOf\u003cBackendEvent\u003e()\n        runBlocking {\n            client.sendMessage(SendMessageRequest(\"id\", \"sendMessage\", \"s1\", \"test\"))\n                .collect { events.add(it) }\n        }\n        \n        assertTrue(events.any { it is TokenEvent \u0026\u0026 it.text == \"Hello\" })\n    }\n    \n    @Test\n    fun `parses SSE done events`() {\n        mockServer.enqueue(MockResponse()\n            .setBody(\"data: {\\\"type\\\":\\\"done\\\",\\\"sessionId\\\":\\\"s1\\\"}\\n\\n\"))\n        \n        val events = mutableListOf\u003cBackendEvent\u003e()\n        runBlocking {\n            client.sendMessage(SendMessageRequest(\"id\", \"sendMessage\", \"s1\", \"test\"))\n                .collect { events.add(it) }\n        }\n        \n        assertTrue(events.any { it is DoneEvent })\n    }\n    \n    @Test\n    fun `handles connection error`() {\n        mockServer.shutdown()\n        \n        assertThrows\u003cIOException\u003e {\n            runBlocking {\n                client.sendMessage(SendMessageRequest(\"id\", \"sendMessage\", \"s1\", \"test\"))\n                    .collect {}\n            }\n        }\n    }\n    \n    @Test\n    fun `cancel aborts request`() {\n        // Slow response\n        mockServer.enqueue(MockResponse()\n            .setBody(\"data: {\\\"type\\\":\\\"token\\\",\\\"sessionId\\\":\\\"s1\\\",\\\"text\\\":\\\"1\\\"}\\n\\n\")\n            .throttleBody(1, 1, TimeUnit.SECONDS))\n        \n        runBlocking {\n            val job = launch {\n                client.sendMessage(SendMessageRequest(\"id\", \"sendMessage\", \"s1\", \"test\"))\n                    .collect {}\n            }\n            delay(100)\n            client.cancel(\"s1\")\n            job.join()\n        }\n        \n        // Should complete without collecting all tokens\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Authorization header tests\n- [ ] SSE parsing tests\n- [ ] Error handling tests\n- [ ] Cancel functionality tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":120,"created_at":"2026-01-24T09:25:52.700771+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:25:52.700771+07:00","labels":["backend","rest","sse","tdd","test"],"dependencies":[{"issue_id":"cb-5zs.10","depends_on_id":"cb-5zs","type":"parent-child","created_at":"2026-01-24T09:25:52.702284+07:00","created_by":"mochadwi"}]}
{"id":"cb-5zs.11","title":"Write tests for command palette actions","description":"## TDD: Test First\n\nWrite tests for command palette actions.\n\n## Test Cases\n\n```kotlin\nclass CommandPaletteActionsTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `OpenToolWindow action is registered`() {\n        val action = ActionManager.getInstance()\n            .getAction(\"Codebuff.OpenToolWindow\")\n        \n        assertNotNull(action)\n    }\n    \n    @Test\n    fun `NewSession action is registered`() {\n        val action = ActionManager.getInstance()\n            .getAction(\"Codebuff.NewSession\")\n        \n        assertNotNull(action)\n    }\n    \n    @Test\n    fun `SendSelection action is registered`() {\n        val action = ActionManager.getInstance()\n            .getAction(\"Codebuff.SendSelection\")\n        \n        assertNotNull(action)\n    }\n    \n    @Test\n    fun `AddFileToContext action is registered`() {\n        val action = ActionManager.getInstance()\n            .getAction(\"Codebuff.AddFileToContext\")\n        \n        assertNotNull(action)\n    }\n    \n    @Test\n    fun `ReviewChanges action is registered`() {\n        val action = ActionManager.getInstance()\n            .getAction(\"Codebuff.ReviewChanges\")\n        \n        assertNotNull(action)\n    }\n    \n    @Test\n    fun `CancelOperation action is registered`() {\n        val action = ActionManager.getInstance()\n            .getAction(\"Codebuff.CancelOperation\")\n        \n        assertNotNull(action)\n    }\n    \n    @Test\n    fun `actions in Codebuff group`() {\n        val group = ActionManager.getInstance()\n            .getAction(\"Codebuff.Actions\") as ActionGroup\n        \n        val children = group.getChildren(null)\n        assertTrue(children.isNotEmpty())\n    }\n    \n    @Test\n    fun `actions searchable via Find Action`() {\n        // Verify actions have proper text for search\n        val action = ActionManager.getInstance()\n            .getAction(\"Codebuff.OpenToolWindow\")\n        \n        assertNotNull(action?.templatePresentation?.text)\n        assertTrue(action?.templatePresentation?.text?.contains(\"Codebuff\") == true)\n    }\n    \n    @Test\n    fun `actions have keyboard shortcuts`() {\n        val action = ActionManager.getInstance()\n            .getAction(\"Codebuff.OpenToolWindow\")\n        \n        val shortcuts = action?.shortcutSet?.shortcuts\n        assertTrue(shortcuts?.isNotEmpty() == true)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Action registration tests\n- [ ] Action group tests\n- [ ] Shortcut tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":60,"created_at":"2026-01-24T09:25:52.800231+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:25:52.800231+07:00","labels":["actions","palette","tdd","test"],"dependencies":[{"issue_id":"cb-5zs.11","depends_on_id":"cb-5zs","type":"parent-child","created_at":"2026-01-24T09:25:52.804323+07:00","created_by":"mochadwi"}]}
{"id":"cb-5zs.12","title":"Write tests for clickable file paths","description":"## TDD: Test First\n\nWrite tests for clickable file paths in output.\n\n## Test Cases\n\n```kotlin\nclass OutputLinkifierTest : BasePlatformTestCase() {\n    \n    private lateinit var linkifier: OutputLinkifier\n    \n    override fun setUp() {\n        super.setUp()\n        linkifier = OutputLinkifier(project)\n    }\n    \n    @Test\n    fun `detects simple file path`() {\n        val text = \"See src/Main.kt for details\"\n        \n        val matches = linkifier.findLinks(text)\n        \n        assertEquals(1, matches.size)\n        assertEquals(\"src/Main.kt\", matches[0].path)\n    }\n    \n    @Test\n    fun `detects file path with line number`() {\n        val text = \"Error at src/Main.kt#L42\"\n        \n        val matches = linkifier.findLinks(text)\n        \n        assertEquals(1, matches.size)\n        assertEquals(\"src/Main.kt\", matches[0].path)\n        assertEquals(42, matches[0].line)\n    }\n    \n    @Test\n    fun `detects file path with line range`() {\n        val text = \"See src/Main.kt#L10-20\"\n        \n        val matches = linkifier.findLinks(text)\n        \n        assertEquals(1, matches.size)\n        assertEquals(10, matches[0].startLine)\n        assertEquals(20, matches[0].endLine)\n    }\n    \n    @Test\n    fun `detects @-prefixed path`() {\n        val text = \"Modified @src/Main.kt\"\n        \n        val matches = linkifier.findLinks(text)\n        \n        assertEquals(1, matches.size)\n        assertEquals(\"src/Main.kt\", matches[0].path)\n    }\n    \n    @Test\n    fun `detects quoted path with spaces`() {\n        val text = \"See @\\\"path/with spaces/file.kt\\\"\"\n        \n        val matches = linkifier.findLinks(text)\n        \n        assertEquals(1, matches.size)\n        assertEquals(\"path/with spaces/file.kt\", matches[0].path)\n    }\n    \n    @Test\n    fun `detects multiple paths`() {\n        val text = \"Compare src/A.kt and src/B.kt\"\n        \n        val matches = linkifier.findLinks(text)\n        \n        assertEquals(2, matches.size)\n    }\n    \n    @Test\n    fun `handleClick opens file in editor`() {\n        val file = createFile(\"test.kt\", \"content\")\n        \n        linkifier.handleClick(\"test.kt\", null)\n        \n        val openFile = FileEditorManager.getInstance(project).selectedFiles.firstOrNull()\n        assertEquals(file.name, openFile?.name)\n    }\n    \n    @Test\n    fun `handleClick navigates to line`() {\n        val file = createFile(\"test.kt\", \"line1\\nline2\\nline3\")\n        \n        linkifier.handleClick(\"test.kt\", 2)\n        \n        val editor = FileEditorManager.getInstance(project).selectedTextEditor\n        val caretLine = editor?.caretModel?.logicalPosition?.line\n        assertEquals(1, caretLine) // 0-indexed\n    }\n    \n    @Test\n    fun `linkifyText creates styled document`() {\n        val text = \"See src/Main.kt\"\n        \n        val doc = linkifier.linkifyText(text)\n        \n        assertNotNull(doc)\n        assertTrue(doc.length \u003e 0)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Path detection tests\n- [ ] Line number parsing tests\n- [ ] Navigation tests\n- [ ] Styled document tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:25:52.894353+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:25:52.894353+07:00","labels":["navigation","tdd","test","ui"],"dependencies":[{"issue_id":"cb-5zs.12","depends_on_id":"cb-5zs","type":"parent-child","created_at":"2026-01-24T09:25:52.895842+07:00","created_by":"mochadwi"}]}
{"id":"cb-5zs.2","title":"Implement tool call visibility in chat","description":"Render tool calls inline in chat UI as collapsible panels.\n\n## Implementation\n```kotlin\nsealed class ChatMessage {\n    data class User(val text: String, val context: List\u003cContextItem\u003e) : ChatMessage()\n    data class Assistant(val text: String) : ChatMessage()\n    data class ToolCall(\n        val id: String,\n        val tool: String,\n        val input: JsonObject,\n        var result: JsonObject? = null,\n        var collapsed: Boolean = true\n    ) : ChatMessage()\n}\n\nclass ToolCallPanel(private val toolCall: ChatMessage.ToolCall) : JPanel(BorderLayout()) {\n    \n    init {\n        val header = JPanel(FlowLayout(FlowLayout.LEFT)).apply {\n            add(JBLabel(AllIcons.Actions.Execute))\n            add(JBLabel(toolCall.tool).apply {\n                font = font.deriveFont(Font.BOLD)\n            })\n            add(JBLabel(\"â–¼\").apply {\n                cursor = Cursor.getPredefinedCursor(Cursor.HAND_CURSOR)\n            })\n        }\n        \n        val content = JBTextArea().apply {\n            text = formatJson(toolCall.input)\n            isEditable = false\n            isVisible = !toolCall.collapsed\n        }\n        \n        header.addMouseListener(object : MouseAdapter() {\n            override fun mouseClicked(e: MouseEvent) {\n                toolCall.collapsed = !toolCall.collapsed\n                content.isVisible = !toolCall.collapsed\n            }\n        })\n        \n        add(header, BorderLayout.NORTH)\n        add(content, BorderLayout.CENTER)\n        \n        background = JBColor(Color(240, 240, 240), Color(50, 50, 50))\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Tool calls appear inline in chat\n- [ ] Collapsible panels work\n- [ ] Input/output formatted nicely\n- [ ] Different styling from regular messages","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":150,"created_at":"2026-01-24T02:04:26.124414+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:04:26.124414+07:00","labels":["tools","ui"],"dependencies":[{"issue_id":"cb-5zs.2","depends_on_id":"cb-5zs","type":"parent-child","created_at":"2026-01-24T02:04:26.125117+07:00","created_by":"mochadwi"},{"issue_id":"cb-5zs.2","depends_on_id":"cb-5zs.8","type":"blocks","created_at":"2026-01-24T09:26:31.534882+07:00","created_by":"mochadwi"}]}
{"id":"cb-5zs.3","title":"Implement auto-diagnostics context","description":"Automatically suggest adding IDE diagnostics to context.\n\n## Implementation\n```kotlin\nclass DiagnosticsWatcher(private val project: Project) : DaemonCodeAnalyzer.DaemonListener {\n    \n    private val contextCollector = project.service\u003cContextCollector\u003e()\n    \n    override fun daemonFinished(fileEditors: Collection\u003cFileEditor\u003e) {\n        if (!settings.autoDiagnostics) return\n        \n        fileEditors.forEach { editor -\u003e\n            val file = (editor as? TextEditor)?.file ?: return@forEach\n            val diagnostics = contextCollector.collectDiagnostics(file)\n            \n            if (diagnostics.isNotEmpty()) {\n                suggestAddDiagnostics(file, diagnostics)\n            }\n        }\n    }\n    \n    private fun suggestAddDiagnostics(file: VirtualFile, diagnostics: List\u003cContextItem.Diagnostic\u003e) {\n        val errorCount = diagnostics.count { it.severity == \"error\" }\n        if (errorCount == 0) return\n        \n        CodebuffNotifications.notifyInfo(\n            project,\n            \"${file.name} has $errorCount error(s). Add to Codebuff context?\"\n        ).addAction(object : AnAction(\"Add Errors\") {\n            override fun actionPerformed(e: AnActionEvent) {\n                diagnostics.filter { it.severity == \"error\" }.forEach {\n                    contextPanel.addAttachment(it)\n                }\n            }\n        })\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Diagnostics detected when analysis completes\n- [ ] Suggestion shown for files with errors\n- [ ] Can add errors to context with one click\n- [ ] Respects settings toggle","status":"open","priority":2,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":120,"created_at":"2026-01-24T02:04:26.230791+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:04:26.230791+07:00","labels":["auto","context","diagnostics"],"dependencies":[{"issue_id":"cb-5zs.3","depends_on_id":"cb-5zs","type":"parent-child","created_at":"2026-01-24T02:04:26.232722+07:00","created_by":"mochadwi"},{"issue_id":"cb-5zs.3","depends_on_id":"cb-5zs.9","type":"blocks","created_at":"2026-01-24T09:26:31.594867+07:00","created_by":"mochadwi"}]}
{"id":"cb-5zs.4","title":"Implement REST/SSE backend client","description":"Alternative backend client using REST API and SSE for cloud mode.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/backend/RestBackendClient.kt\n\n## Implementation\n```kotlin\nclass RestBackendClient(\n    private val project: Project,\n    private val baseUrl: String,\n    private val apiKey: String\n) : BackendClient {\n    \n    private val client = OkHttpClient.Builder()\n        .connectTimeout(10, TimeUnit.SECONDS)\n        .readTimeout(0, TimeUnit.SECONDS) // No timeout for SSE\n        .build()\n    \n    private val gson = Gson()\n    \n    override suspend fun sendMessage(request: MessageRequest): Flow\u003cBackendEvent\u003e = callbackFlow {\n        val httpRequest = Request.Builder()\n            .url(\"$baseUrl/api/v1/sessions/${request.sessionId}/messages\")\n            .header(\"Authorization\", \"Bearer $apiKey\")\n            .header(\"Accept\", \"text/event-stream\")\n            .post(gson.toJson(request).toRequestBody(\"application/json\".toMediaType()))\n            .build()\n        \n        val call = client.newCall(httpRequest)\n        \n        call.enqueue(object : Callback {\n            override fun onResponse(call: Call, response: Response) {\n                response.body?.source()?.use { source -\u003e\n                    val reader = EventSource.Factory.newFactory(source)\n                    // Parse SSE events and emit\n                    while (!source.exhausted()) {\n                        val line = source.readUtf8Line() ?: continue\n                        if (line.startsWith(\"data:\")) {\n                            val data = line.removePrefix(\"data:\").trim()\n                            val event = parseEvent(data)\n                            trySend(event)\n                        }\n                    }\n                }\n                close()\n            }\n            \n            override fun onFailure(call: Call, e: IOException) {\n                close(e)\n            }\n        })\n        \n        awaitClose { call.cancel() }\n    }\n}\n```\n\n## Settings Integration\n- Backend type selector: CLI / REST\n- API endpoint URL\n- API key (secure storage)\n\n## Acceptance Criteria\n- [ ] REST requests work\n- [ ] SSE streaming parses correctly\n- [ ] Authentication via API key\n- [ ] Switchable in settings","status":"open","priority":2,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":240,"created_at":"2026-01-24T02:04:26.33484+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:04:26.33484+07:00","labels":["backend","rest","sse"],"dependencies":[{"issue_id":"cb-5zs.4","depends_on_id":"cb-5zs","type":"parent-child","created_at":"2026-01-24T02:04:26.33556+07:00","created_by":"mochadwi"},{"issue_id":"cb-5zs.4","depends_on_id":"cb-5zs.10","type":"blocks","created_at":"2026-01-24T09:26:31.655165+07:00","created_by":"mochadwi"}]}
{"id":"cb-5zs.5","title":"Add command palette actions","description":"Register actions in Find Action (Cmd+Shift+A).\n\n## Implementation\nUpdate plugin.xml with comprehensive action groups:\n```xml\n\u003cactions\u003e\n    \u003cgroup id=\"Codebuff.Actions\" text=\"Codebuff\" popup=\"true\"\u003e\n        \u003caction id=\"Codebuff.OpenToolWindow\" \n                class=\"com.codebuff.intellij.actions.OpenToolWindowAction\"\n                text=\"Open Codebuff\"\n                description=\"Open the Codebuff tool window\"\u003e\n            \u003ckeyboard-shortcut keymap=\"$default\" first-keystroke=\"ctrl shift C\"/\u003e\n        \u003c/action\u003e\n        \n        \u003caction id=\"Codebuff.NewSession\"\n                class=\"com.codebuff.intellij.actions.NewSessionAction\"\n                text=\"New Codebuff Session\"\n                description=\"Start a new Codebuff session\"/\u003e\n        \n        \u003caction id=\"Codebuff.SendSelection\"\n                class=\"com.codebuff.intellij.actions.SendSelectionAction\"\n                text=\"Ask Codebuff About Selection\"\n                description=\"Send selected code to Codebuff\"\u003e\n            \u003ckeyboard-shortcut keymap=\"$default\" first-keystroke=\"alt ctrl K\"/\u003e\n        \u003c/action\u003e\n        \n        \u003caction id=\"Codebuff.AddFileToContext\"\n                class=\"com.codebuff.intellij.actions.AddFileToContextAction\"\n                text=\"Add File to Codebuff Context\"\n                description=\"Add current file to Codebuff context\"/\u003e\n        \n        \u003caction id=\"Codebuff.ReviewChanges\"\n                class=\"com.codebuff.intellij.actions.ReviewChangesAction\"\n                text=\"Review Codebuff Changes\"\n                description=\"Review pending changes from Codebuff\"/\u003e\n        \n        \u003caction id=\"Codebuff.CancelOperation\"\n                class=\"com.codebuff.intellij.actions.CancelOperationAction\"\n                text=\"Cancel Codebuff Operation\"\n                description=\"Cancel the current Codebuff operation\"/\u003e\n        \n        \u003cadd-to-group group-id=\"ToolsMenu\" anchor=\"last\"/\u003e\n    \u003c/group\u003e\n\u003c/actions\u003e\n```\n\n## Acceptance Criteria\n- [ ] All actions searchable via Cmd+Shift+A\n- [ ] Shortcuts work\n- [ ] Actions in Tools menu\n- [ ] Context-appropriate enable/disable","status":"open","priority":2,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T02:04:26.437261+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:04:26.437261+07:00","labels":["actions","palette"],"dependencies":[{"issue_id":"cb-5zs.5","depends_on_id":"cb-5zs","type":"parent-child","created_at":"2026-01-24T02:04:26.437918+07:00","created_by":"mochadwi"},{"issue_id":"cb-5zs.5","depends_on_id":"cb-5zs.11","type":"blocks","created_at":"2026-01-24T09:26:31.719737+07:00","created_by":"mochadwi"}]}
{"id":"cb-5zs.6","title":"Implement clickable file paths in output","description":"Make file paths in chat output clickable to open in editor.\n\n## Implementation\n```kotlin\nclass OutputLinkifier(private val project: Project) {\n    \n    // Match patterns like: src/main/App.kt, ./file.ts, path/to/file.py#L10\n    private val filePattern = Regex(\n        \"\"\"(@?\"?([\\w./\\-]+\\.[a-zA-Z]+)(#L(\\d+)(-\\d+)?)?\"?)\"\"\"\n    )\n    \n    fun linkifyText(text: String): StyledDocument {\n        val doc = DefaultStyledDocument()\n        var lastEnd = 0\n        \n        filePattern.findAll(text).forEach { match -\u003e\n            // Add plain text before match\n            doc.insertString(doc.length, text.substring(lastEnd, match.range.first), null)\n            \n            // Add clickable link\n            val linkStyle = SimpleAttributeSet().apply {\n                StyleConstants.setForeground(this, JBColor.BLUE)\n                StyleConstants.setUnderline(this, true)\n            }\n            doc.insertString(doc.length, match.value, linkStyle)\n            \n            lastEnd = match.range.last + 1\n        }\n        \n        // Add remaining text\n        doc.insertString(doc.length, text.substring(lastEnd), null)\n        \n        return doc\n    }\n    \n    fun handleClick(path: String, line: Int?) {\n        val basePath = project.basePath ?: return\n        val file = LocalFileSystem.getInstance()\n            .findFileByPath(\"$basePath/$path\") ?: return\n        \n        val descriptor = OpenFileDescriptor(project, file, line?.minus(1) ?: 0, 0)\n        FileEditorManager.getInstance(project).openTextEditor(descriptor, true)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] File paths appear as links\n- [ ] Clicking opens file in editor\n- [ ] Line numbers navigate correctly\n- [ ] Works for relative and absolute paths","status":"open","priority":2,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":120,"created_at":"2026-01-24T02:04:26.535405+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:04:26.535405+07:00","labels":["navigation","ui"],"dependencies":[{"issue_id":"cb-5zs.6","depends_on_id":"cb-5zs","type":"parent-child","created_at":"2026-01-24T02:04:26.536935+07:00","created_by":"mochadwi"},{"issue_id":"cb-5zs.6","depends_on_id":"cb-5zs.12","type":"blocks","created_at":"2026-01-24T09:26:31.777682+07:00","created_by":"mochadwi"}]}
{"id":"cb-5zs.7","title":"Write tests for terminal integration","description":"## TDD: Test First\n\nWrite tests for terminal log integration.\n\n## Test Cases\n\n```kotlin\nclass TerminalIntegrationTest : BasePlatformTestCase() {\n    \n    private lateinit var terminalFactory: CodebuffTerminalFactory\n    \n    override fun setUp() {\n        super.setUp()\n        terminalFactory = CodebuffTerminalFactory(project)\n    }\n    \n    @Test\n    fun `createLogTerminal returns widget`() {\n        val widget = terminalFactory.createLogTerminal()\n        \n        assertNotNull(widget)\n    }\n    \n    @Test\n    fun `terminal has correct name`() {\n        val widget = terminalFactory.createLogTerminal()\n        \n        assertEquals(\"Codebuff Logs\", widget?.terminalTitle)\n    }\n    \n    @Test\n    fun `writeToTerminal appends text`() {\n        val widget = terminalFactory.createLogTerminal()\n        \n        terminalFactory.writeToTerminal(widget!!, \"test log\")\n        \n        // Verify text was written (may need to check internal buffer)\n    }\n    \n    @Test\n    fun `tool call events logged when trace enabled`() {\n        val settings = CodebuffSettings.getInstance()\n        settings.state.traceEnabled = true\n        val logs = mutableListOf\u003cString\u003e()\n        \n        // Mock terminal to capture logs\n        val event = ToolCallEvent(\"s1\", \"read_files\", JsonObject())\n        \n        val logLine = formatLogLine(event)\n        \n        assertTrue(logLine.contains(\"[TOOL]\"))\n        assertTrue(logLine.contains(\"read_files\"))\n    }\n    \n    @Test\n    fun `tool result events logged`() {\n        val event = ToolResultEvent(\"s1\", \"read_files\", JsonObject())\n        \n        val logLine = formatLogLine(event)\n        \n        assertTrue(logLine.contains(\"[RESULT]\"))\n    }\n    \n    @Test\n    fun `token events not logged (too noisy)`() {\n        val event = TokenEvent(\"s1\", \"text\")\n        \n        val logLine = formatLogLine(event)\n        \n        assertNull(logLine)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Terminal creation tests\n- [ ] Log formatting tests\n- [ ] Trace toggle tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:25:52.422024+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:25:52.422024+07:00","labels":["logging","tdd","terminal","test"],"dependencies":[{"issue_id":"cb-5zs.7","depends_on_id":"cb-5zs","type":"parent-child","created_at":"2026-01-24T09:25:52.422835+07:00","created_by":"mochadwi"}]}
{"id":"cb-5zs.8","title":"Write tests for tool call visibility","description":"## TDD: Test First\n\nWrite tests for tool call visibility in chat UI.\n\n## Test Cases\n\n```kotlin\nclass ToolCallVisibilityTest : BasePlatformTestCase() {\n    \n    private lateinit var chatPanel: ChatPanel\n    \n    override fun setUp() {\n        super.setUp()\n        chatPanel = ChatPanel(project)\n    }\n    \n    @Test\n    fun `tool call rendered as collapsible panel`() {\n        val event = ToolCallEvent(\"s1\", \"read_files\", JsonObject())\n        \n        chatPanel.onToolCall(event)\n        \n        val toolPanel = chatPanel.findComponent\u003cToolCallPanel\u003e()\n        assertNotNull(toolPanel)\n    }\n    \n    @Test\n    fun `tool panel shows tool name`() {\n        val event = ToolCallEvent(\"s1\", \"read_files\", JsonObject())\n        \n        chatPanel.onToolCall(event)\n        \n        val toolPanel = chatPanel.findComponent\u003cToolCallPanel\u003e()\n        assertTrue(toolPanel?.getToolName() == \"read_files\")\n    }\n    \n    @Test\n    fun `tool panel collapsed by default`() {\n        val event = ToolCallEvent(\"s1\", \"read_files\", JsonObject())\n        \n        chatPanel.onToolCall(event)\n        \n        val toolPanel = chatPanel.findComponent\u003cToolCallPanel\u003e()\n        assertTrue(toolPanel?.isCollapsed == true)\n    }\n    \n    @Test\n    fun `clicking header toggles collapsed state`() {\n        val event = ToolCallEvent(\"s1\", \"read_files\", JsonObject())\n        chatPanel.onToolCall(event)\n        val toolPanel = chatPanel.findComponent\u003cToolCallPanel\u003e()!!\n        \n        toolPanel.toggleCollapse()\n        \n        assertFalse(toolPanel.isCollapsed)\n    }\n    \n    @Test\n    fun `expanded panel shows input JSON`() {\n        val input = JsonObject().apply { addProperty(\"path\", \"test.kt\") }\n        val event = ToolCallEvent(\"s1\", \"read_files\", input)\n        chatPanel.onToolCall(event)\n        val toolPanel = chatPanel.findComponent\u003cToolCallPanel\u003e()!!\n        \n        toolPanel.toggleCollapse()\n        \n        assertTrue(toolPanel.getContentText().contains(\"test.kt\"))\n    }\n    \n    @Test\n    fun `tool result updates panel`() {\n        val callEvent = ToolCallEvent(\"s1\", \"read_files\", JsonObject())\n        val resultEvent = ToolResultEvent(\"s1\", \"read_files\", \n            JsonObject().apply { addProperty(\"content\", \"file content\") })\n        \n        chatPanel.onToolCall(callEvent)\n        chatPanel.onToolResult(resultEvent)\n        \n        val toolPanel = chatPanel.findComponent\u003cToolCallPanel\u003e()!!\n        toolPanel.toggleCollapse()\n        assertTrue(toolPanel.getContentText().contains(\"file content\"))\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Panel rendering tests\n- [ ] Collapse/expand tests\n- [ ] Content display tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:25:52.516184+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:25:52.516184+07:00","labels":["tdd","test","tools","ui"],"dependencies":[{"issue_id":"cb-5zs.8","depends_on_id":"cb-5zs","type":"parent-child","created_at":"2026-01-24T09:25:52.516976+07:00","created_by":"mochadwi"}]}
{"id":"cb-5zs.9","title":"Write tests for auto-diagnostics context","description":"## TDD: Test First\n\nWrite tests for auto-diagnostics context feature.\n\n## Test Cases\n\n```kotlin\nclass AutoDiagnosticsContextTest : BasePlatformTestCase() {\n    \n    private lateinit var watcher: DiagnosticsWatcher\n    \n    override fun setUp() {\n        super.setUp()\n        watcher = DiagnosticsWatcher(project)\n    }\n    \n    @Test\n    fun `watcher respects setting toggle`() {\n        CodebuffSettings.getInstance().state.autoDiagnostics = false\n        val file = myFixture.configureByText(\"Error.kt\", \"undefined()\")\n        myFixture.doHighlighting()\n        \n        watcher.onDaemonFinished(listOf(getFileEditor(file)))\n        \n        // Should not suggest adding diagnostics\n        verifyNoNotification()\n    }\n    \n    @Test\n    fun `watcher suggests diagnostics when errors found`() {\n        CodebuffSettings.getInstance().state.autoDiagnostics = true\n        val file = myFixture.configureByText(\"Error.kt\", \"undefined()\")\n        myFixture.doHighlighting()\n        var notificationShown = false\n        \n        watcher.onDaemonFinished(listOf(getFileEditor(file)))\n        \n        // Verify suggestion notification shown\n        assertTrue(notificationShown)\n    }\n    \n    @Test\n    fun `watcher ignores files without errors`() {\n        CodebuffSettings.getInstance().state.autoDiagnostics = true\n        val file = myFixture.configureByText(\"Valid.kt\", \"fun valid() {}\")\n        myFixture.doHighlighting()\n        \n        watcher.onDaemonFinished(listOf(getFileEditor(file)))\n        \n        // No notification for valid files\n        verifyNoNotification()\n    }\n    \n    @Test\n    fun `add errors action adds to context`() {\n        val contextPanel = project.service\u003cCodebuffProjectService\u003e().getContextPanel()\n        val initialCount = contextPanel.getAttachments().size\n        \n        watcher.addErrorsToContext(listOf(\n            ContextItem.Diagnostic(\"test.kt\", 1, \"error\", \"message\")\n        ))\n        \n        assertEquals(initialCount + 1, contextPanel.getAttachments().size)\n    }\n    \n    @Test\n    fun `only errors added, not warnings`() {\n        val diagnostics = listOf(\n            ContextItem.Diagnostic(\"test.kt\", 1, \"error\", \"error msg\"),\n            ContextItem.Diagnostic(\"test.kt\", 2, \"warning\", \"warn msg\")\n        )\n        val contextPanel = project.service\u003cCodebuffProjectService\u003e().getContextPanel()\n        \n        watcher.addErrorsToContext(diagnostics.filter { it.severity == \"error\" })\n        \n        assertEquals(1, contextPanel.getAttachments().size)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Setting toggle tests\n- [ ] Error detection tests\n- [ ] Context addition tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:25:52.61027+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:25:52.61027+07:00","labels":["auto","context","diagnostics","tdd","test"],"dependencies":[{"issue_id":"cb-5zs.9","depends_on_id":"cb-5zs","type":"parent-child","created_at":"2026-01-24T09:25:52.611098+07:00","created_by":"mochadwi"}]}
{"id":"cb-ble","title":"Phase 2: CLI Backend Bridge \u0026 Streaming","description":"## Overview\nImplement the CLI backend client that spawns Codebuff CLI as subprocess and communicates via JSON Lines over stdio. Handle streaming events and route them to UI.\n\n## Goals\n- Robust process lifecycle management (start, restart, shutdown)\n- JSON Lines protocol implementation for request/response\n- Streaming event parsing and routing\n- Settings page for CLI path configuration\n\n## Success Criteria\n- Send message â†’ receive streaming response reliably\n- Cancel operation works correctly\n- No IDE freezes (all I/O on background threads)\n- Backend auto-restarts on crash\n- Settings page allows configuring CLI path\n\n## Technical Scope\n\n### Process Management\n- `ProcessBuilder` to spawn `codebuff ide --stdio`\n- Watchdog with exponential backoff restart\n- Graceful shutdown on project close\n\n### Protocol Implementation\n- Request framing: JSON Lines with request IDs\n- Event parsing: token, tool_call, tool_result, diff, error, done\n- Cancel semantics via stdin message\n\n### Threading\n- `Dispatchers.IO` for process I/O\n- Event marshaling to EDT for UI updates\n- Proper coroutine scope management\n\n## Effort Estimate\nM (3-5 days)\n\n## Reference\n- [OpenCode_UI SseEventListener](https://github.com/LaiZhou/OpenCode_UI/blob/main/src/main/kotlin/ai/opencode/ide/jetbrains/api/SseEventListener.kt)\n- [Codebuff CLI](https://github.com/CodebuffAI/codebuff/tree/main/cli)","status":"open","priority":0,"issue_type":"epic","owner":"moch.iqbaldc@gmail.com","created_at":"2026-01-24T01:59:18.147401+07:00","created_by":"mochadwi","updated_at":"2026-01-24T01:59:18.147401+07:00","labels":["backend","epic","phase-2"],"dependencies":[{"issue_id":"cb-ble","depends_on_id":"cb-vnl","type":"blocks","created_at":"2026-01-24T09:26:37.365286+07:00","created_by":"mochadwi"}]}
{"id":"cb-ble.1","title":"Implement CliBackendClient process management","description":"Implement process lifecycle for spawning Codebuff CLI.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/backend/CliBackendClient.kt\n- src/main/kotlin/com/codebuff/intellij/backend/ProcessManager.kt\n\n## Implementation\n```kotlin\nclass CliBackendClient(\n    private val project: Project,\n    private val cliPath: String\n) : BackendClient, Disposable {\n    \n    private var process: Process? = null\n    private var stdin: BufferedWriter? = null\n    private var stdout: BufferedReader? = null\n    private val scope = CoroutineScope(Dispatchers.IO + SupervisorJob())\n    \n    override suspend fun connect() {\n        val workDir = project.basePath ?: throw IllegalStateException(\"No project path\")\n        \n        val pb = ProcessBuilder(cliPath, \"ide\", \"--stdio\")\n            .directory(File(workDir))\n            .redirectErrorStream(false)\n        \n        process = pb.start()\n        stdin = process!!.outputStream.bufferedWriter()\n        stdout = process!!.inputStream.bufferedReader()\n        \n        // Start event reader coroutine\n        launchEventReader()\n    }\n    \n    private fun launchEventReader() {\n        scope.launch {\n            try {\n                stdout?.lineSequence()?.forEach { line -\u003e\n                    val event = parseEvent(line)\n                    eventBus.emit(event)\n                }\n            } catch (e: Exception) {\n                handleDisconnect(e)\n            }\n        }\n    }\n    \n    private suspend fun handleDisconnect(error: Exception?) {\n        // Exponential backoff restart\n    }\n}\n```\n\n## Process Lifecycle\n1. Start on first message or explicit connect\n2. Watchdog monitors process health\n3. Auto-restart with backoff on crash\n4. Graceful shutdown on project close\n\n## Acceptance Criteria\n- [ ] Process starts successfully\n- [ ] Process restarts on crash\n- [ ] Clean shutdown on dispose\n- [ ] No zombie processes","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":240,"created_at":"2026-01-24T02:01:26.783314+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:01:26.783314+07:00","labels":["backend","process"],"dependencies":[{"issue_id":"cb-ble.1","depends_on_id":"cb-ble","type":"parent-child","created_at":"2026-01-24T02:01:26.784108+07:00","created_by":"mochadwi"},{"issue_id":"cb-ble.1","depends_on_id":"cb-ble.7","type":"blocks","created_at":"2026-01-24T09:26:06.695409+07:00","created_by":"mochadwi"}]}
{"id":"cb-ble.10","title":"Write tests for UI streaming integration","description":"## TDD: Test First\n\nWrite tests for ChatPanel receiving streaming events.\n\n## Test Cases\n\n```kotlin\nclass ChatPanelStreamingTest : BasePlatformTestCase() {\n    \n    private lateinit var chatPanel: ChatPanel\n    private lateinit var router: StreamingEventRouter\n    \n    override fun setUp() {\n        super.setUp()\n        router = project.service\u003cStreamingEventRouter\u003e()\n        chatPanel = ChatPanel(project)\n    }\n    \n    @Test\n    fun `displays streaming tokens`() {\n        router.routeEvent(TokenEvent(\"s1\", \"Hello \"))\n        router.routeEvent(TokenEvent(\"s1\", \"World\"))\n        waitForEdt()\n        \n        val displayText = chatPanel.getDisplayText()\n        assertTrue(displayText.contains(\"Hello World\"))\n    }\n    \n    @Test\n    fun `shows loading indicator during streaming`() {\n        router.routeEvent(TokenEvent(\"s1\", \"Starting...\"))\n        waitForEdt()\n        \n        assertTrue(chatPanel.isLoading)\n    }\n    \n    @Test\n    fun `hides loading indicator on done`() {\n        router.routeEvent(TokenEvent(\"s1\", \"Done\"))\n        router.routeEvent(DoneEvent(\"s1\"))\n        waitForEdt()\n        \n        assertFalse(chatPanel.isLoading)\n    }\n    \n    @Test\n    fun `displays error messages`() {\n        router.routeEvent(ErrorEvent(\"s1\", \"Something went wrong\"))\n        waitForEdt()\n        \n        val displayText = chatPanel.getDisplayText()\n        assertTrue(displayText.contains(\"Something went wrong\"))\n    }\n    \n    @Test\n    fun `input disabled during streaming`() {\n        router.routeEvent(TokenEvent(\"s1\", \"Working...\"))\n        waitForEdt()\n        \n        assertFalse(chatPanel.isInputEnabled)\n    }\n    \n    @Test\n    fun `input enabled after done`() {\n        router.routeEvent(DoneEvent(\"s1\"))\n        waitForEdt()\n        \n        assertTrue(chatPanel.isInputEnabled)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Token display tests\n- [ ] Loading state tests\n- [ ] Error display tests\n- [ ] Input state tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:22:36.507305+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:22:36.507305+07:00","labels":["streaming","tdd","test","ui"],"dependencies":[{"issue_id":"cb-ble.10","depends_on_id":"cb-ble","type":"parent-child","created_at":"2026-01-24T09:22:36.508046+07:00","created_by":"mochadwi"}]}
{"id":"cb-ble.11","title":"Write tests for cancel functionality","description":"## TDD: Test First\n\nWrite tests for cancel operation.\n\n## Test Cases\n\n```kotlin\nclass CancelFunctionalityTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `cancel sends CancelRequest to backend`() {\n        val mockClient = mockk\u003cBackendClient\u003e(relaxed = true)\n        val service = CodebuffProjectService(project, mockClient)\n        \n        runBlocking { service.cancel() }\n        \n        coVerify { mockClient.cancel(any()) }\n    }\n    \n    @Test\n    fun `cancel request includes session id`() {\n        val capturedRequest = slot\u003cCancelRequest\u003e()\n        val mockClient = mockk\u003cBackendClient\u003e {\n            coEvery { cancel(capture(capturedRequest)) } just Runs\n        }\n        val service = CodebuffProjectService(project, mockClient)\n        service.sessionManager.createSession().also { \n            service.sessionManager.setActiveSession(it) \n        }\n        \n        runBlocking { service.cancel() }\n        \n        assertNotNull(capturedRequest.captured.sessionId)\n    }\n    \n    @Test\n    fun `cancel button visible during operation`() {\n        val chatPanel = ChatPanel(project)\n        \n        chatPanel.setLoading(true)\n        \n        assertTrue(chatPanel.cancelButton.isVisible)\n    }\n    \n    @Test\n    fun `cancel button hidden when idle`() {\n        val chatPanel = ChatPanel(project)\n        \n        chatPanel.setLoading(false)\n        \n        assertFalse(chatPanel.cancelButton.isVisible)\n    }\n    \n    @Test\n    fun `cancel resets UI state`() {\n        val chatPanel = ChatPanel(project)\n        chatPanel.setLoading(true)\n        \n        chatPanel.onCancel()\n        \n        assertFalse(chatPanel.isLoading)\n        assertTrue(chatPanel.isInputEnabled)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Cancel request tests\n- [ ] UI state tests\n- [ ] Reset behavior tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":60,"created_at":"2026-01-24T09:22:36.608615+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:22:36.608615+07:00","labels":["backend","cancel","tdd","test"],"dependencies":[{"issue_id":"cb-ble.11","depends_on_id":"cb-ble","type":"parent-child","created_at":"2026-01-24T09:22:36.614321+07:00","created_by":"mochadwi"}]}
{"id":"cb-ble.12","title":"Write tests for settings page","description":"## TDD: Test First\n\nWrite tests for settings configuration.\n\n## Test Cases\n\n```kotlin\nclass CodebuffSettingsTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `settings service is registered`() {\n        val settings = CodebuffSettings.getInstance()\n        assertNotNull(settings)\n    }\n    \n    @Test\n    fun `default CLI path is codebuff`() {\n        val settings = CodebuffSettings.getInstance()\n        assertEquals(\"codebuff\", settings.state.cliPath)\n    }\n    \n    @Test\n    fun `can update CLI path`() {\n        val settings = CodebuffSettings.getInstance()\n        settings.state.cliPath = \"/custom/path/codebuff\"\n        \n        assertEquals(\"/custom/path/codebuff\", settings.state.cliPath)\n    }\n    \n    @Test\n    fun `settings persist across reload`() {\n        val settings = CodebuffSettings.getInstance()\n        settings.state.cliPath = \"/test/path\"\n        settings.state.autoApplyChanges = true\n        \n        // Simulate reload\n        val newState = settings.state.copy()\n        settings.loadState(newState)\n        \n        assertEquals(\"/test/path\", settings.state.cliPath)\n        assertTrue(settings.state.autoApplyChanges)\n    }\n}\n\nclass CodebuffSettingsConfigurableTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `configurable has correct display name`() {\n        val configurable = CodebuffSettingsConfigurable()\n        assertEquals(\"Codebuff\", configurable.displayName)\n    }\n    \n    @Test\n    fun `configurable creates component`() {\n        val configurable = CodebuffSettingsConfigurable()\n        val component = configurable.createComponent()\n        \n        assertNotNull(component)\n    }\n    \n    @Test\n    fun `isModified returns false initially`() {\n        val configurable = CodebuffSettingsConfigurable()\n        configurable.createComponent()\n        \n        assertFalse(configurable.isModified)\n    }\n    \n    @Test\n    fun `apply saves settings`() {\n        val configurable = CodebuffSettingsConfigurable()\n        configurable.createComponent()\n        // Modify via UI\n        configurable.apply()\n        \n        // Should not throw\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Settings persistence tests\n- [ ] Configurable UI tests\n- [ ] Default values tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":60,"created_at":"2026-01-24T09:22:36.701285+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:22:36.701285+07:00","labels":["settings","tdd","test","ui"],"dependencies":[{"issue_id":"cb-ble.12","depends_on_id":"cb-ble","type":"parent-child","created_at":"2026-01-24T09:22:36.70199+07:00","created_by":"mochadwi"}]}
{"id":"cb-ble.2","title":"Implement JSON Lines protocol","description":"Implement the JSON Lines request/response protocol.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/backend/Protocol.kt\n- src/main/kotlin/com/codebuff/intellij/backend/Messages.kt\n\n## Protocol Definition\n```kotlin\n// Requests\nsealed class BackendRequest {\n    abstract val id: String\n    abstract val type: String\n}\n\ndata class SendMessageRequest(\n    override val id: String = UUID.randomUUID().toString(),\n    override val type: String = \"sendMessage\",\n    val sessionId: String,\n    val text: String,\n    val context: List\u003cContextItem\u003e = emptyList()\n) : BackendRequest()\n\ndata class CancelRequest(\n    override val id: String = UUID.randomUUID().toString(),\n    override val type: String = \"cancel\",\n    val sessionId: String\n) : BackendRequest()\n\n// Events\nsealed class BackendEvent {\n    abstract val sessionId: String\n}\n\ndata class TokenEvent(\n    override val sessionId: String,\n    val text: String\n) : BackendEvent()\n\ndata class ToolCallEvent(\n    override val sessionId: String,\n    val tool: String,\n    val input: JsonObject\n) : BackendEvent()\n\ndata class DiffEvent(\n    override val sessionId: String,\n    val files: List\u003cFileDiff\u003e\n) : BackendEvent()\n\ndata class ErrorEvent(\n    override val sessionId: String,\n    val message: String,\n    val code: String? = null\n) : BackendEvent()\n\ndata class DoneEvent(\n    override val sessionId: String\n) : BackendEvent()\n```\n\n## Serialization\n- Use Gson for JSON serialization\n- One JSON object per line (no newlines in content)\n- Request IDs for correlation\n\n## Acceptance Criteria\n- [ ] Requests serialize correctly\n- [ ] Events deserialize correctly\n- [ ] Unknown event types handled gracefully\n- [ ] Malformed JSON doesn't crash","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":180,"created_at":"2026-01-24T02:01:26.871859+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:01:26.871859+07:00","labels":["backend","protocol"],"dependencies":[{"issue_id":"cb-ble.2","depends_on_id":"cb-ble","type":"parent-child","created_at":"2026-01-24T02:01:26.872567+07:00","created_by":"mochadwi"},{"issue_id":"cb-ble.2","depends_on_id":"cb-ble.8","type":"blocks","created_at":"2026-01-24T09:26:06.770988+07:00","created_by":"mochadwi"}]}
{"id":"cb-ble.3","title":"Implement StreamingEventRouter","description":"Route backend events to UI components.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/backend/StreamingEventRouter.kt\n\n## Implementation\n```kotlin\nclass StreamingEventRouter(private val project: Project) {\n    \n    private val _events = MutableSharedFlow\u003cBackendEvent\u003e()\n    val events: SharedFlow\u003cBackendEvent\u003e = _events.asSharedFlow()\n    \n    private val listeners = mutableListOf\u003cEventListener\u003e()\n    \n    interface EventListener {\n        fun onToken(event: TokenEvent)\n        fun onToolCall(event: ToolCallEvent)\n        fun onToolResult(event: ToolResultEvent)\n        fun onDiff(event: DiffEvent)\n        fun onError(event: ErrorEvent)\n        fun onDone(event: DoneEvent)\n    }\n    \n    fun routeEvent(event: BackendEvent) {\n        // Always dispatch to EDT for UI updates\n        ApplicationManager.getApplication().invokeLater {\n            when (event) {\n                is TokenEvent -\u003e listeners.forEach { it.onToken(event) }\n                is ToolCallEvent -\u003e listeners.forEach { it.onToolCall(event) }\n                is DiffEvent -\u003e listeners.forEach { it.onDiff(event) }\n                is ErrorEvent -\u003e listeners.forEach { it.onError(event) }\n                is DoneEvent -\u003e listeners.forEach { it.onDone(event) }\n            }\n        }\n        \n        // Also emit to Flow for coroutine consumers\n        scope.launch { _events.emit(event) }\n    }\n}\n```\n\n## Threading Guarantees\n- Events received on IO thread\n- UI callbacks on EDT\n- Flow emissions on IO\n\n## Acceptance Criteria\n- [ ] Events reach UI on EDT\n- [ ] No race conditions\n- [ ] Multiple listeners supported\n- [ ] Clean unsubscription","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":120,"created_at":"2026-01-24T02:01:26.960517+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:01:26.960517+07:00","labels":["backend","events"],"dependencies":[{"issue_id":"cb-ble.3","depends_on_id":"cb-ble","type":"parent-child","created_at":"2026-01-24T02:01:26.961182+07:00","created_by":"mochadwi"},{"issue_id":"cb-ble.3","depends_on_id":"cb-ble.9","type":"blocks","created_at":"2026-01-24T09:26:06.84308+07:00","created_by":"mochadwi"}]}
{"id":"cb-ble.4","title":"Connect UI to streaming events","description":"Wire up ChatPanel to receive and display streaming events.\n\n## Files\n- Update: src/main/kotlin/com/codebuff/intellij/ui/ChatPanel.kt\n\n## Implementation\n```kotlin\nclass ChatPanel(private val project: Project) : JPanel(), StreamingEventRouter.EventListener {\n    \n    private val messagesPane = JBTextArea()\n    private val currentResponse = StringBuilder()\n    \n    init {\n        project.service\u003cStreamingEventRouter\u003e().addListener(this)\n    }\n    \n    override fun onToken(event: TokenEvent) {\n        currentResponse.append(event.text)\n        updateDisplay()\n    }\n    \n    override fun onDone(event: DoneEvent) {\n        // Finalize message\n        addMessage(AssistantMessage(currentResponse.toString()))\n        currentResponse.clear()\n    }\n    \n    override fun onError(event: ErrorEvent) {\n        showError(event.message)\n    }\n    \n    private fun updateDisplay() {\n        // Efficient incremental update\n        messagesPane.text = buildDisplayText()\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Tokens stream in real-time\n- [ ] No UI freezing during streaming\n- [ ] Errors displayed appropriately\n- [ ] Done event finalizes message","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":150,"created_at":"2026-01-24T02:01:27.048404+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:01:27.048404+07:00","labels":["streaming","ui"],"dependencies":[{"issue_id":"cb-ble.4","depends_on_id":"cb-ble","type":"parent-child","created_at":"2026-01-24T02:01:27.049092+07:00","created_by":"mochadwi"},{"issue_id":"cb-ble.4","depends_on_id":"cb-ble.10","type":"blocks","created_at":"2026-01-24T09:26:06.907651+07:00","created_by":"mochadwi"}]}
{"id":"cb-ble.5","title":"Implement cancel functionality","description":"Allow user to cancel ongoing operations.\n\n## Implementation\n```kotlin\n// In CliBackendClient\noverride suspend fun cancel(sessionId: String) {\n    val request = CancelRequest(sessionId = sessionId)\n    sendRequest(request)\n}\n\n// In ChatPanel\nprivate val cancelButton = JButton(\"Stop\").apply {\n    isVisible = false\n    addActionListener {\n        scope.launch {\n            project.service\u003cCodebuffProjectService\u003e().cancel()\n        }\n    }\n}\n\n// Show cancel button during streaming\noverride fun onToken(event: TokenEvent) {\n    cancelButton.isVisible = true\n    // ...\n}\n\noverride fun onDone(event: DoneEvent) {\n    cancelButton.isVisible = false\n    // ...\n}\n```\n\n## Acceptance Criteria\n- [ ] Cancel button appears during streaming\n- [ ] Cancel stops the operation\n- [ ] UI resets to ready state\n- [ ] Backend acknowledges cancel","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T02:01:27.139826+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:01:27.139826+07:00","labels":["backend","cancel"],"dependencies":[{"issue_id":"cb-ble.5","depends_on_id":"cb-ble","type":"parent-child","created_at":"2026-01-24T02:01:27.140502+07:00","created_by":"mochadwi"},{"issue_id":"cb-ble.5","depends_on_id":"cb-ble.11","type":"blocks","created_at":"2026-01-24T09:26:06.970287+07:00","created_by":"mochadwi"}]}
{"id":"cb-ble.6","title":"Create settings page for CLI configuration","description":"Settings UI for configuring CLI path and options.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/settings/CodebuffSettings.kt\n- src/main/kotlin/com/codebuff/intellij/settings/CodebuffSettingsConfigurable.kt\n\n## Implementation\n```kotlin\n@State(name = \"CodebuffSettings\", storages = [Storage(\"codebuff.xml\")])\nclass CodebuffSettings : PersistentStateComponent\u003cCodebuffSettings.State\u003e {\n    data class State(\n        var cliPath: String = \"codebuff\",  // Default: find in PATH\n        var autoApplyChanges: Boolean = false,\n        var showToolCalls: Boolean = true,\n        var traceEnabled: Boolean = false\n    )\n    \n    private var state = State()\n    \n    override fun getState() = state\n    override fun loadState(state: State) { this.state = state }\n    \n    companion object {\n        fun getInstance(): CodebuffSettings = \n            ApplicationManager.getApplication().getService(CodebuffSettings::class.java)\n    }\n}\n\nclass CodebuffSettingsConfigurable : Configurable {\n    private var panel: CodebuffSettingsPanel? = null\n    \n    override fun createComponent(): JComponent {\n        panel = CodebuffSettingsPanel()\n        return panel!!\n    }\n    \n    override fun isModified(): Boolean = panel?.isModified() == true\n    override fun apply() { panel?.apply() }\n    override fun getDisplayName() = \"Codebuff\"\n}\n```\n\n## Settings Panel\n- CLI path with file chooser\n- Auto-apply toggle\n- Show tool calls toggle\n- Test connection button\n\n## Acceptance Criteria\n- [ ] Settings page appears in Preferences\n- [ ] Settings persist across restarts\n- [ ] CLI path configurable\n- [ ] Test connection works","status":"open","priority":2,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":120,"created_at":"2026-01-24T02:01:27.228252+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:01:27.228252+07:00","labels":["settings","ui"],"dependencies":[{"issue_id":"cb-ble.6","depends_on_id":"cb-ble","type":"parent-child","created_at":"2026-01-24T02:01:27.229195+07:00","created_by":"mochadwi"},{"issue_id":"cb-ble.6","depends_on_id":"cb-ble.12","type":"blocks","created_at":"2026-01-24T09:26:07.027905+07:00","created_by":"mochadwi"}]}
{"id":"cb-ble.7","title":"Write tests for CliBackendClient process management","description":"## TDD: Test First\n\nWrite tests for CLI process lifecycle before implementing.\n\n## Test Cases\n\n```kotlin\nclass CliBackendClientTest : BasePlatformTestCase() {\n    \n    private lateinit var client: CliBackendClient\n    \n    override fun setUp() {\n        super.setUp()\n        client = CliBackendClient(project, \"echo\") // Use echo as mock CLI\n    }\n    \n    override fun tearDown() {\n        client.dispose()\n        super.tearDown()\n    }\n    \n    @Test\n    fun `connect starts process`() = runBlocking {\n        client.connect()\n        \n        assertTrue(client.isConnected)\n    }\n    \n    @Test\n    fun `disconnect stops process`() = runBlocking {\n        client.connect()\n        client.disconnect()\n        \n        assertFalse(client.isConnected)\n    }\n    \n    @Test\n    fun `dispose cleans up process`() = runBlocking {\n        client.connect()\n        client.dispose()\n        \n        assertFalse(client.isConnected)\n    }\n    \n    @Test\n    fun `reconnects after process crash`() = runBlocking {\n        client.connect()\n        // Simulate crash\n        client.simulateCrash()\n        \n        delay(2000) // Wait for reconnect\n        \n        assertTrue(client.isConnected)\n    }\n    \n    @Test\n    fun `respects max reconnect attempts`() = runBlocking {\n        client.maxReconnectAttempts = 2\n        client.connect()\n        \n        repeat(3) { client.simulateCrash() }\n        delay(5000)\n        \n        assertFalse(client.isConnected)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Process lifecycle tests\n- [ ] Reconnection logic tests\n- [ ] Cleanup/dispose tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":120,"created_at":"2026-01-24T09:22:36.238686+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:22:36.238686+07:00","labels":["backend","process","tdd","test"],"dependencies":[{"issue_id":"cb-ble.7","depends_on_id":"cb-ble","type":"parent-child","created_at":"2026-01-24T09:22:36.23942+07:00","created_by":"mochadwi"}]}
{"id":"cb-ble.8","title":"Write tests for JSON Lines protocol","description":"## TDD: Test First\n\nWrite tests for protocol serialization/deserialization.\n\n## Test Cases\n\n```kotlin\nclass ProtocolTest {\n    \n    private val gson = Gson()\n    \n    // Request Serialization Tests\n    \n    @Test\n    fun `SendMessageRequest serializes correctly`() {\n        val request = SendMessageRequest(\n            id = \"req-001\",\n            sessionId = \"sess-123\",\n            text = \"Hello\",\n            context = emptyList()\n        )\n        \n        val json = gson.toJson(request)\n        \n        assertTrue(json.contains(\"\\\"type\\\":\\\"sendMessage\\\"\"))\n        assertTrue(json.contains(\"\\\"id\\\":\\\"req-001\\\"\"))\n        assertTrue(json.contains(\"\\\"sessionId\\\":\\\"sess-123\\\"\"))\n    }\n    \n    @Test\n    fun `CancelRequest serializes correctly`() {\n        val request = CancelRequest(sessionId = \"sess-123\")\n        \n        val json = gson.toJson(request)\n        \n        assertTrue(json.contains(\"\\\"type\\\":\\\"cancel\\\"\"))\n    }\n    \n    // Event Deserialization Tests\n    \n    @Test\n    fun `TokenEvent deserializes correctly`() {\n        val json = \"{\\\"type\\\":\\\"token\\\",\\\"sessionId\\\":\\\"sess-123\\\",\\\"text\\\":\\\"Hello\\\"}\"\n        \n        val event = Protocol.parseEvent(json)\n        \n        assertTrue(event is TokenEvent)\n        assertEquals(\"Hello\", (event as TokenEvent).text)\n    }\n    \n    @Test\n    fun `ToolCallEvent deserializes correctly`() {\n        val json = \"{\\\"type\\\":\\\"tool_call\\\",\\\"sessionId\\\":\\\"s1\\\",\\\"tool\\\":\\\"read_files\\\",\\\"input\\\":{}}\"\n        \n        val event = Protocol.parseEvent(json)\n        \n        assertTrue(event is ToolCallEvent)\n        assertEquals(\"read_files\", (event as ToolCallEvent).tool)\n    }\n    \n    @Test\n    fun `DiffEvent deserializes with files`() {\n        val json = \"{\\\"type\\\":\\\"diff\\\",\\\"sessionId\\\":\\\"s1\\\",\\\"files\\\":[{\\\"path\\\":\\\"a.kt\\\",\\\"before\\\":\\\"\\\",\\\"after\\\":\\\"code\\\"}]}\"\n        \n        val event = Protocol.parseEvent(json)\n        \n        assertTrue(event is DiffEvent)\n        assertEquals(1, (event as DiffEvent).files.size)\n    }\n    \n    @Test\n    fun `unknown event type returns UnknownEvent`() {\n        val json = \"{\\\"type\\\":\\\"future_event\\\",\\\"sessionId\\\":\\\"s1\\\"}\"\n        \n        val event = Protocol.parseEvent(json)\n        \n        assertTrue(event is UnknownEvent)\n    }\n    \n    @Test\n    fun `malformed JSON throws ParseException`() {\n        val json = \"not valid json\"\n        \n        assertThrows\u003cJsonParseException\u003e {\n            Protocol.parseEvent(json)\n        }\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] All request types serialized\n- [ ] All event types deserialized\n- [ ] Error handling for malformed input","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:22:36.328389+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:22:36.328389+07:00","labels":["backend","protocol","tdd","test"],"dependencies":[{"issue_id":"cb-ble.8","depends_on_id":"cb-ble","type":"parent-child","created_at":"2026-01-24T09:22:36.329079+07:00","created_by":"mochadwi"}]}
{"id":"cb-ble.9","title":"Write tests for StreamingEventRouter","description":"## TDD: Test First\n\nWrite tests for event routing before implementing.\n\n## Test Cases\n\n```kotlin\nclass StreamingEventRouterTest : BasePlatformTestCase() {\n    \n    private lateinit var router: StreamingEventRouter\n    private lateinit var listener: TestEventListener\n    \n    override fun setUp() {\n        super.setUp()\n        router = StreamingEventRouter(project)\n        listener = TestEventListener()\n        router.addListener(listener)\n    }\n    \n    @Test\n    fun `routes TokenEvent to listener`() {\n        val event = TokenEvent(\"sess-1\", \"text\")\n        \n        router.routeEvent(event)\n        waitForEdt()\n        \n        assertEquals(1, listener.tokenEvents.size)\n        assertEquals(\"text\", listener.tokenEvents[0].text)\n    }\n    \n    @Test\n    fun `routes ToolCallEvent to listener`() {\n        val event = ToolCallEvent(\"sess-1\", \"read_files\", JsonObject())\n        \n        router.routeEvent(event)\n        waitForEdt()\n        \n        assertEquals(1, listener.toolCallEvents.size)\n    }\n    \n    @Test\n    fun `routes DiffEvent to listener`() {\n        val event = DiffEvent(\"sess-1\", listOf())\n        \n        router.routeEvent(event)\n        waitForEdt()\n        \n        assertEquals(1, listener.diffEvents.size)\n    }\n    \n    @Test\n    fun `events delivered on EDT`() {\n        var wasOnEdt = false\n        val listener = object : StreamingEventRouter.EventListener {\n            override fun onToken(event: TokenEvent) {\n                wasOnEdt = SwingUtilities.isEventDispatchThread()\n            }\n            // ... other methods\n        }\n        router.addListener(listener)\n        \n        router.routeEvent(TokenEvent(\"s1\", \"t\"))\n        waitForEdt()\n        \n        assertTrue(wasOnEdt)\n    }\n    \n    @Test\n    fun `multiple listeners receive events`() {\n        val listener2 = TestEventListener()\n        router.addListener(listener2)\n        \n        router.routeEvent(TokenEvent(\"s1\", \"t\"))\n        waitForEdt()\n        \n        assertEquals(1, listener.tokenEvents.size)\n        assertEquals(1, listener2.tokenEvents.size)\n    }\n    \n    @Test\n    fun `removed listener stops receiving events`() {\n        router.removeListener(listener)\n        \n        router.routeEvent(TokenEvent(\"s1\", \"t\"))\n        waitForEdt()\n        \n        assertEquals(0, listener.tokenEvents.size)\n    }\n    \n    private class TestEventListener : StreamingEventRouter.EventListener {\n        val tokenEvents = mutableListOf\u003cTokenEvent\u003e()\n        val toolCallEvents = mutableListOf\u003cToolCallEvent\u003e()\n        val diffEvents = mutableListOf\u003cDiffEvent\u003e()\n        \n        override fun onToken(event: TokenEvent) { tokenEvents.add(event) }\n        override fun onToolCall(event: ToolCallEvent) { toolCallEvents.add(event) }\n        override fun onDiff(event: DiffEvent) { diffEvents.add(event) }\n        // ... other methods\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Event routing to listeners\n- [ ] EDT thread guarantees\n- [ ] Listener management tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:22:36.414665+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:22:36.414665+07:00","labels":["backend","events","tdd","test"],"dependencies":[{"issue_id":"cb-ble.9","depends_on_id":"cb-ble","type":"parent-child","created_at":"2026-01-24T09:22:36.415387+07:00","created_by":"mochadwi"}]}
{"id":"cb-blv","title":"Phase 4: Diff Review \u0026 Apply","description":"## Overview\nImplement diff review functionality using IntelliJ's native Diff API. Show proposed changes from Codebuff before applying them to the codebase.\n\n## Goals\n- Parse diff/patch data from backend events\n- Display multi-file diff using IntelliJ Diff API\n- Accept/Reject actions per file or all at once\n- Safe file modification via write actions\n- Handle conflicts (file changed since diff)\n\n## Success Criteria\n- Diff viewer opens when backend proposes changes\n- User can navigate between files in multi-file diff\n- Accept applies changes correctly\n- Reject discards changes\n- Conflicts detected and shown to user\n- Files modified only via WriteCommandAction\n\n## Technical Scope\n\n### Diff Integration\n```kotlin\n// Use IntelliJ's SimpleDiffRequestChain for multi-file diffs\nval requests = files.map { file -\u003e\n    SimpleDiffRequest(\n        file.path,\n        DiffContentFactory.getInstance().create(file.before),\n        DiffContentFactory.getInstance().create(file.after),\n        \"Before\", \"After\"\n    )\n}\nval chain = SimpleDiffRequestChain(requests)\nDiffManager.getInstance().showDiff(project, chain)\n```\n\n### Actions\n- AcceptDiffAction: Apply patch via VFS write action\n- RejectDiffAction: Discard and close diff\n- AcceptAllAction: Apply all files\n- Custom toolbar in diff viewer\n\n### Conflict Handling\n- Compare file mtime/hash before apply\n- Show warning if file changed\n- Option to force apply or re-fetch diff\n\n### File Safety\n- All modifications via `WriteCommandAction.runWriteCommandAction()`\n- Validate paths within project bounds\n- Create backup before apply (optional)\n\n## Effort Estimate\nM-L (4-6 days)\n\n## Reference\n- [OpenCode_UI DiffViewerService](https://github.com/LaiZhou/OpenCode_UI/blob/main/src/main/kotlin/ai/opencode/ide/jetbrains/diff/DiffViewerService.kt)\n- [OpenCode_UI DiffActions](https://github.com/LaiZhou/OpenCode_UI/blob/main/src/main/kotlin/ai/opencode/ide/jetbrains/diff/OpenCodeDiffEditorActions.kt)\n- [IntelliJ Diff API](https://plugins.jetbrains.com/docs/intellij/diff.html)","status":"open","priority":1,"issue_type":"epic","owner":"moch.iqbaldc@gmail.com","created_at":"2026-01-24T01:59:44.460143+07:00","created_by":"mochadwi","updated_at":"2026-01-24T01:59:44.460143+07:00","labels":["diff","epic","phase-4"],"dependencies":[{"issue_id":"cb-blv","depends_on_id":"cb-0jl","type":"blocks","created_at":"2026-01-24T09:26:37.486818+07:00","created_by":"mochadwi"}]}
{"id":"cb-blv.1","title":"Parse diff events from backend","description":"Parse diff/patch data from backend events into structured format.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/diff/DiffParser.kt\n- src/main/kotlin/com/codebuff/intellij/model/FileDiff.kt\n\n## Data Model\n```kotlin\ndata class FileDiff(\n    val path: String,\n    val before: String,\n    val after: String,\n    val operation: Operation\n) {\n    enum class Operation { CREATE, MODIFY, DELETE }\n}\n\nobject DiffParser {\n    fun parseFromEvent(event: DiffEvent): List\u003cFileDiff\u003e {\n        return event.files.map { file -\u003e\n            FileDiff(\n                path = file.get(\"path\").asString,\n                before = file.get(\"before\")?.asString ?: \"\",\n                after = file.get(\"after\")?.asString ?: \"\",\n                operation = when {\n                    file.get(\"before\")?.asString.isNullOrEmpty() -\u003e Operation.CREATE\n                    file.get(\"after\")?.asString.isNullOrEmpty() -\u003e Operation.DELETE\n                    else -\u003e Operation.MODIFY\n                }\n            )\n        }\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Create/modify/delete detected correctly\n- [ ] Content parsed without corruption\n- [ ] Unicode content handled\n- [ ] Empty files handled","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T02:02:35.384311+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:02:35.384311+07:00","labels":["diff","parsing"],"dependencies":[{"issue_id":"cb-blv.1","depends_on_id":"cb-blv","type":"parent-child","created_at":"2026-01-24T02:02:35.385106+07:00","created_by":"mochadwi"},{"issue_id":"cb-blv.1","depends_on_id":"cb-blv.6","type":"blocks","created_at":"2026-01-24T09:26:18.910454+07:00","created_by":"mochadwi"}]}
{"id":"cb-blv.10","title":"Write tests for diff toolbar and shortcuts","description":"## TDD: Test First\n\nWrite tests for diff toolbar and keyboard shortcuts.\n\n## Test Cases\n\n```kotlin\nclass DiffToolbarTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `diff action provider is registered`() {\n        val providers = DiffActionProvider.EP_NAME.extensionList\n        \n        assertTrue(providers.any { it is CodebuffDiffActionProvider })\n    }\n    \n    @Test\n    fun `provider is active for Codebuff diffs`() {\n        val provider = CodebuffDiffActionProvider()\n        val event = createDiffEvent(withCodebuffData = true)\n        \n        assertTrue(provider.isActive(event))\n    }\n    \n    @Test\n    fun `provider is inactive for non-Codebuff diffs`() {\n        val provider = CodebuffDiffActionProvider()\n        val event = createDiffEvent(withCodebuffData = false)\n        \n        assertFalse(provider.isActive(event))\n    }\n    \n    @Test\n    fun `provider returns accept and reject actions`() {\n        val provider = CodebuffDiffActionProvider()\n        \n        val actions = provider.actions\n        \n        assertTrue(actions.any { it is AcceptDiffAction })\n        assertTrue(actions.any { it is RejectDiffAction })\n    }\n    \n    @Test\n    fun `provider includes accept all action`() {\n        val provider = CodebuffDiffActionProvider()\n        \n        val actions = provider.actions\n        \n        assertTrue(actions.any { it is AcceptAllAction })\n    }\n}\n\nclass DiffKeyboardShortcutsTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `accept action has keyboard shortcut`() {\n        val action = ActionManager.getInstance().getAction(\"Codebuff.AcceptDiff\")\n        \n        val shortcuts = action?.shortcutSet?.shortcuts\n        \n        assertTrue(shortcuts?.isNotEmpty() == true)\n    }\n    \n    @Test\n    fun `reject action has keyboard shortcut`() {\n        val action = ActionManager.getInstance().getAction(\"Codebuff.RejectDiff\")\n        \n        val shortcuts = action?.shortcutSet?.shortcuts\n        \n        assertTrue(shortcuts?.isNotEmpty() == true)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Provider registration tests\n- [ ] Action availability tests\n- [ ] Shortcut configuration tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":60,"created_at":"2026-01-24T09:24:09.214703+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:24:09.214703+07:00","labels":["diff","tdd","test","ui"],"dependencies":[{"issue_id":"cb-blv.10","depends_on_id":"cb-blv","type":"parent-child","created_at":"2026-01-24T09:24:09.21539+07:00","created_by":"mochadwi"}]}
{"id":"cb-blv.2","title":"Implement DiffViewerService","description":"Service to display diffs using IntelliJ Diff API.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/diff/DiffViewerService.kt\n\n## Implementation\n```kotlin\n@Service(Service.Level.PROJECT)\nclass DiffViewerService(private val project: Project) {\n    \n    fun showDiffs(diffs: List\u003cFileDiff\u003e) {\n        if (diffs.isEmpty()) return\n        \n        val contentFactory = DiffContentFactory.getInstance()\n        \n        val requests = diffs.map { diff -\u003e\n            val beforeContent = contentFactory.create(diff.before)\n            val afterContent = contentFactory.create(diff.after)\n            \n            SimpleDiffRequest(\n                diff.path,\n                beforeContent,\n                afterContent,\n                \"Current\",\n                \"Proposed\"\n            ).apply {\n                putUserData(DIFF_KEY, diff)\n            }\n        }\n        \n        val chain = SimpleDiffRequestChain(requests)\n        chain.putUserData(CHAIN_KEY, diffs)\n        \n        DiffManager.getInstance().showDiff(project, chain, DiffDialogHints.FRAME)\n    }\n    \n    companion object {\n        val DIFF_KEY = Key.create\u003cFileDiff\u003e(\"codebuff.diff\")\n        val CHAIN_KEY = Key.create\u003cList\u003cFileDiff\u003e\u003e(\"codebuff.diffs\")\n    }\n}\n```\n\n## Features\n- Multi-file diff navigation\n- Progress indicator (1 of N)\n- Syntax highlighting based on file type\n\n## Acceptance Criteria\n- [ ] Diff viewer opens correctly\n- [ ] Multiple files navigable\n- [ ] Syntax highlighting works\n- [ ] Before/After labeled correctly","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":180,"created_at":"2026-01-24T02:02:35.472506+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:02:35.472506+07:00","labels":["diff","viewer"],"dependencies":[{"issue_id":"cb-blv.2","depends_on_id":"cb-blv","type":"parent-child","created_at":"2026-01-24T02:02:35.473881+07:00","created_by":"mochadwi"},{"issue_id":"cb-blv.2","depends_on_id":"cb-blv.7","type":"blocks","created_at":"2026-01-24T09:26:18.970389+07:00","created_by":"mochadwi"}]}
{"id":"cb-blv.3","title":"Implement Accept/Reject diff actions","description":"Actions to accept or reject proposed changes.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/diff/DiffActions.kt\n\n## Implementation\n```kotlin\nclass AcceptDiffAction : AnAction(\"Accept\", \"Apply this change\", AllIcons.Actions.Commit) {\n    override fun actionPerformed(e: AnActionEvent) {\n        val diff = getDiff(e) ?: return\n        val project = e.project ?: return\n        \n        WriteCommandAction.runWriteCommandAction(project) {\n            val basePath = project.basePath ?: return@runWriteCommandAction\n            val file = LocalFileSystem.getInstance()\n                .findFileByPath(\"$basePath/${diff.path}\")\n            \n            when (diff.operation) {\n                Operation.CREATE -\u003e createFile(basePath, diff)\n                Operation.MODIFY -\u003e modifyFile(file, diff)\n                Operation.DELETE -\u003e deleteFile(file)\n            }\n        }\n        \n        // Close this diff and show next\n        closeAndShowNext(e)\n    }\n    \n    private fun modifyFile(file: VirtualFile?, diff: FileDiff) {\n        file ?: return\n        val document = FileDocumentManager.getInstance().getDocument(file)\n        document?.setText(diff.after)\n    }\n}\n\nclass RejectDiffAction : AnAction(\"Reject\", \"Discard this change\", AllIcons.Actions.Cancel) {\n    override fun actionPerformed(e: AnActionEvent) {\n        // Just close and show next\n        closeAndShowNext(e)\n    }\n}\n\nclass AcceptAllAction : AnAction(\"Accept All\", \"Apply all changes\", AllIcons.Actions.Commit) {\n    override fun actionPerformed(e: AnActionEvent) {\n        val diffs = getAllDiffs(e) ?: return\n        val project = e.project ?: return\n        \n        WriteCommandAction.runWriteCommandAction(project, \"Apply Codebuff Changes\", null, {\n            diffs.forEach { diff -\u003e applyDiff(project, diff) }\n        })\n        \n        closeDiffViewer(e)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Accept applies changes correctly\n- [ ] Reject discards without changes\n- [ ] Accept All applies all files\n- [ ] Navigation to next diff works","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":180,"created_at":"2026-01-24T02:02:35.572244+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:02:35.572244+07:00","labels":["actions","diff"],"dependencies":[{"issue_id":"cb-blv.3","depends_on_id":"cb-blv","type":"parent-child","created_at":"2026-01-24T02:02:35.572934+07:00","created_by":"mochadwi"},{"issue_id":"cb-blv.3","depends_on_id":"cb-blv.8","type":"blocks","created_at":"2026-01-24T09:26:19.027171+07:00","created_by":"mochadwi"}]}
{"id":"cb-blv.4","title":"Handle file conflicts","description":"Detect and handle when file changed since diff was generated.\n\n## Implementation\n```kotlin\nclass ConflictDetector(private val project: Project) {\n    \n    private val fileSnapshots = mutableMapOf\u003cString, FileSnapshot\u003e()\n    \n    data class FileSnapshot(\n        val path: String,\n        val modificationStamp: Long,\n        val contentHash: String\n    )\n    \n    fun captureSnapshot(path: String) {\n        val file = findFile(path) ?: return\n        fileSnapshots[path] = FileSnapshot(\n            path = path,\n            modificationStamp = file.modificationStamp,\n            contentHash = file.contentsToByteArray().contentHashCode().toString()\n        )\n    }\n    \n    fun hasConflict(diff: FileDiff): Boolean {\n        val snapshot = fileSnapshots[diff.path] ?: return false\n        val currentFile = findFile(diff.path) ?: return false\n        \n        return currentFile.modificationStamp != snapshot.modificationStamp\n    }\n    \n    fun showConflictDialog(diff: FileDiff): ConflictResolution {\n        val result = Messages.showDialog(\n            project,\n            \"File '${diff.path}' has been modified since the diff was generated.\",\n            \"Conflict Detected\",\n            arrayOf(\"Force Apply\", \"Refresh Diff\", \"Cancel\"),\n            0,\n            Messages.getWarningIcon()\n        )\n        \n        return when (result) {\n            0 -\u003e ConflictResolution.FORCE_APPLY\n            1 -\u003e ConflictResolution.REFRESH\n            else -\u003e ConflictResolution.CANCEL\n        }\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Conflicts detected correctly\n- [ ] Warning shown to user\n- [ ] Force apply option works\n- [ ] Refresh option available","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":120,"created_at":"2026-01-24T02:02:35.664152+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:02:35.664152+07:00","labels":["conflicts","diff"],"dependencies":[{"issue_id":"cb-blv.4","depends_on_id":"cb-blv","type":"parent-child","created_at":"2026-01-24T02:02:35.664851+07:00","created_by":"mochadwi"},{"issue_id":"cb-blv.4","depends_on_id":"cb-blv.9","type":"blocks","created_at":"2026-01-24T09:26:19.087577+07:00","created_by":"mochadwi"}]}
{"id":"cb-blv.5","title":"Add diff toolbar and keyboard shortcuts","description":"Custom toolbar in diff viewer with Accept/Reject buttons and shortcuts.\n\n## Implementation\nRegister custom diff tool in plugin.xml:\n```xml\n\u003cdiff.actions.provider order=\"first\" implementation=\"com.codebuff.intellij.diff.CodebuffDiffActionProvider\"/\u003e\n```\n\n```kotlin\nclass CodebuffDiffActionProvider : AnActionExtensionProvider {\n    override fun isActive(context: AnActionEvent): Boolean {\n        return context.getData(DiffDataKeys.DIFF_REQUEST)\n            ?.getUserData(DiffViewerService.DIFF_KEY) != null\n    }\n    \n    override fun getActions(): List\u003cAnAction\u003e {\n        return listOf(\n            AcceptDiffAction(),\n            RejectDiffAction(),\n            Separator(),\n            AcceptAllAction(),\n            RejectAllAction()\n        )\n    }\n}\n```\n\n## Keyboard Shortcuts\n- Enter: Accept current\n- Escape: Reject current\n- Cmd+Shift+Enter: Accept all\n- Cmd+Shift+Escape: Reject all\n\n## Acceptance Criteria\n- [ ] Toolbar visible in diff viewer\n- [ ] Shortcuts work\n- [ ] Icons display correctly\n- [ ] Actions enabled/disabled appropriately","status":"open","priority":2,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T02:02:35.751355+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:02:35.751355+07:00","labels":["diff","ui"],"dependencies":[{"issue_id":"cb-blv.5","depends_on_id":"cb-blv","type":"parent-child","created_at":"2026-01-24T02:02:35.751939+07:00","created_by":"mochadwi"},{"issue_id":"cb-blv.5","depends_on_id":"cb-blv.10","type":"blocks","created_at":"2026-01-24T09:26:19.146106+07:00","created_by":"mochadwi"}]}
{"id":"cb-blv.6","title":"Write tests for diff event parsing","description":"## TDD: Test First\n\nWrite tests for diff parsing before implementing.\n\n## Test Cases\n\n```kotlin\nclass DiffParserTest {\n    \n    @Test\n    fun `parseFromEvent extracts file paths`() {\n        val event = createDiffEvent(listOf(\n            mapOf(\"path\" to \"src/Main.kt\", \"before\" to \"old\", \"after\" to \"new\")\n        ))\n        \n        val diffs = DiffParser.parseFromEvent(event)\n        \n        assertEquals(1, diffs.size)\n        assertEquals(\"src/Main.kt\", diffs[0].path)\n    }\n    \n    @Test\n    fun `parseFromEvent detects CREATE operation`() {\n        val event = createDiffEvent(listOf(\n            mapOf(\"path\" to \"new.kt\", \"before\" to \"\", \"after\" to \"new content\")\n        ))\n        \n        val diffs = DiffParser.parseFromEvent(event)\n        \n        assertEquals(FileDiff.Operation.CREATE, diffs[0].operation)\n    }\n    \n    @Test\n    fun `parseFromEvent detects MODIFY operation`() {\n        val event = createDiffEvent(listOf(\n            mapOf(\"path\" to \"mod.kt\", \"before\" to \"old\", \"after\" to \"new\")\n        ))\n        \n        val diffs = DiffParser.parseFromEvent(event)\n        \n        assertEquals(FileDiff.Operation.MODIFY, diffs[0].operation)\n    }\n    \n    @Test\n    fun `parseFromEvent detects DELETE operation`() {\n        val event = createDiffEvent(listOf(\n            mapOf(\"path\" to \"del.kt\", \"before\" to \"content\", \"after\" to \"\")\n        ))\n        \n        val diffs = DiffParser.parseFromEvent(event)\n        \n        assertEquals(FileDiff.Operation.DELETE, diffs[0].operation)\n    }\n    \n    @Test\n    fun `parseFromEvent handles multiple files`() {\n        val event = createDiffEvent(listOf(\n            mapOf(\"path\" to \"a.kt\", \"before\" to \"\", \"after\" to \"a\"),\n            mapOf(\"path\" to \"b.kt\", \"before\" to \"b\", \"after\" to \"\"),\n            mapOf(\"path\" to \"c.kt\", \"before\" to \"c1\", \"after\" to \"c2\")\n        ))\n        \n        val diffs = DiffParser.parseFromEvent(event)\n        \n        assertEquals(3, diffs.size)\n    }\n    \n    @Test\n    fun `parseFromEvent preserves unicode content`() {\n        val event = createDiffEvent(listOf(\n            mapOf(\"path\" to \"unicode.kt\", \"before\" to \"Ð¿Ñ€Ð¸Ð²ÐµÑ‚\", \"after\" to \"ä¸–ç•Œ\")\n        ))\n        \n        val diffs = DiffParser.parseFromEvent(event)\n        \n        assertEquals(\"Ð¿Ñ€Ð¸Ð²ÐµÑ‚\", diffs[0].before)\n        assertEquals(\"ä¸–ç•Œ\", diffs[0].after)\n    }\n    \n    @Test\n    fun `parseFromEvent handles null before for new files`() {\n        val json = \"{\\\"files\\\":[{\\\"path\\\":\\\"new.kt\\\",\\\"after\\\":\\\"code\\\"}]}\"\n        val event = Protocol.parseEvent(json) as DiffEvent\n        \n        val diffs = DiffParser.parseFromEvent(event)\n        \n        assertEquals(FileDiff.Operation.CREATE, diffs[0].operation)\n        assertEquals(\"\", diffs[0].before)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Operation detection tests\n- [ ] Multi-file parsing tests\n- [ ] Edge case handling tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:24:08.852321+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:24:08.852321+07:00","labels":["diff","parsing","tdd","test"],"dependencies":[{"issue_id":"cb-blv.6","depends_on_id":"cb-blv","type":"parent-child","created_at":"2026-01-24T09:24:08.85312+07:00","created_by":"mochadwi"}]}
{"id":"cb-blv.7","title":"Write tests for DiffViewerService","description":"## TDD: Test First\n\nWrite tests for diff viewer service.\n\n## Test Cases\n\n```kotlin\nclass DiffViewerServiceTest : BasePlatformTestCase() {\n    \n    private lateinit var service: DiffViewerService\n    \n    override fun setUp() {\n        super.setUp()\n        service = project.service\u003cDiffViewerService\u003e()\n    }\n    \n    @Test\n    fun `showDiffs does nothing for empty list`() {\n        service.showDiffs(emptyList())\n        \n        // Should not throw or open any dialog\n    }\n    \n    @Test\n    fun `showDiffs creates diff request for single file`() {\n        val diffs = listOf(\n            FileDiff(\"test.kt\", \"old\", \"new\", FileDiff.Operation.MODIFY)\n        )\n        \n        val chain = service.createDiffChain(diffs)\n        \n        assertEquals(1, chain.requests.size)\n    }\n    \n    @Test\n    fun `showDiffs creates chain for multiple files`() {\n        val diffs = listOf(\n            FileDiff(\"a.kt\", \"a1\", \"a2\", FileDiff.Operation.MODIFY),\n            FileDiff(\"b.kt\", \"b1\", \"b2\", FileDiff.Operation.MODIFY)\n        )\n        \n        val chain = service.createDiffChain(diffs)\n        \n        assertEquals(2, chain.requests.size)\n    }\n    \n    @Test\n    fun `diff request has correct title`() {\n        val diffs = listOf(\n            FileDiff(\"src/Main.kt\", \"old\", \"new\", FileDiff.Operation.MODIFY)\n        )\n        \n        val chain = service.createDiffChain(diffs)\n        val request = chain.requests[0]\n        \n        assertTrue(request.title.contains(\"Main.kt\"))\n    }\n    \n    @Test\n    fun `diff request stores FileDiff in user data`() {\n        val diff = FileDiff(\"test.kt\", \"old\", \"new\", FileDiff.Operation.MODIFY)\n        \n        val chain = service.createDiffChain(listOf(diff))\n        val storedDiff = chain.requests[0].getUserData(DiffViewerService.DIFF_KEY)\n        \n        assertEquals(diff, storedDiff)\n    }\n    \n    @Test\n    fun `diff content shows before and after labels`() {\n        val diff = FileDiff(\"test.kt\", \"before\", \"after\", FileDiff.Operation.MODIFY)\n        \n        val request = service.createDiffRequest(diff)\n        \n        assertEquals(\"Current\", request.contentTitles[0])\n        assertEquals(\"Proposed\", request.contentTitles[1])\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Chain creation tests\n- [ ] Request configuration tests\n- [ ] User data storage tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:24:08.94313+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:24:08.94313+07:00","labels":["diff","tdd","test","viewer"],"dependencies":[{"issue_id":"cb-blv.7","depends_on_id":"cb-blv","type":"parent-child","created_at":"2026-01-24T09:24:08.943828+07:00","created_by":"mochadwi"}]}
{"id":"cb-blv.8","title":"Write tests for Accept/Reject actions","description":"## TDD: Test First\n\nWrite tests for diff accept/reject actions.\n\n## Test Cases\n\n```kotlin\nclass AcceptDiffActionTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `accept modifies file with after content`() {\n        val file = createFile(\"test.kt\", \"old content\")\n        val diff = FileDiff(\"test.kt\", \"old content\", \"new content\", FileDiff.Operation.MODIFY)\n        \n        AcceptDiffAction().applyDiff(project, diff)\n        \n        assertEquals(\"new content\", file.readText())\n    }\n    \n    @Test\n    fun `accept creates new file for CREATE operation`() {\n        val diff = FileDiff(\"new.kt\", \"\", \"new content\", FileDiff.Operation.CREATE)\n        \n        AcceptDiffAction().applyDiff(project, diff)\n        \n        val file = findFile(\"new.kt\")\n        assertNotNull(file)\n        assertEquals(\"new content\", file!!.readText())\n    }\n    \n    @Test\n    fun `accept deletes file for DELETE operation`() {\n        createFile(\"delete.kt\", \"content\")\n        val diff = FileDiff(\"delete.kt\", \"content\", \"\", FileDiff.Operation.DELETE)\n        \n        AcceptDiffAction().applyDiff(project, diff)\n        \n        assertNull(findFile(\"delete.kt\"))\n    }\n    \n    @Test\n    fun `accept uses WriteCommandAction`() {\n        val diff = FileDiff(\"test.kt\", \"old\", \"new\", FileDiff.Operation.MODIFY)\n        createFile(\"test.kt\", \"old\")\n        \n        // Should not throw, uses write action internally\n        AcceptDiffAction().applyDiff(project, diff)\n    }\n}\n\nclass RejectDiffActionTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `reject does not modify file`() {\n        val file = createFile(\"test.kt\", \"original\")\n        val diff = FileDiff(\"test.kt\", \"original\", \"changed\", FileDiff.Operation.MODIFY)\n        \n        RejectDiffAction().performReject(project, diff)\n        \n        assertEquals(\"original\", file.readText())\n    }\n}\n\nclass AcceptAllActionTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `accept all applies all diffs`() {\n        createFile(\"a.kt\", \"a1\")\n        createFile(\"b.kt\", \"b1\")\n        val diffs = listOf(\n            FileDiff(\"a.kt\", \"a1\", \"a2\", FileDiff.Operation.MODIFY),\n            FileDiff(\"b.kt\", \"b1\", \"b2\", FileDiff.Operation.MODIFY)\n        )\n        \n        AcceptAllAction().applyAll(project, diffs)\n        \n        assertEquals(\"a2\", findFile(\"a.kt\")!!.readText())\n        assertEquals(\"b2\", findFile(\"b.kt\")!!.readText())\n    }\n    \n    @Test\n    fun `accept all is atomic`() {\n        // If one fails, all should be rolled back (optional)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Accept modifies files correctly\n- [ ] Reject leaves files unchanged\n- [ ] Accept all applies all changes\n- [ ] Write action used for all modifications","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":120,"created_at":"2026-01-24T09:24:09.035898+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:24:09.035898+07:00","labels":["actions","diff","tdd","test"],"dependencies":[{"issue_id":"cb-blv.8","depends_on_id":"cb-blv","type":"parent-child","created_at":"2026-01-24T09:24:09.036646+07:00","created_by":"mochadwi"}]}
{"id":"cb-blv.9","title":"Write tests for conflict detection","description":"## TDD: Test First\n\nWrite tests for file conflict detection.\n\n## Test Cases\n\n```kotlin\nclass ConflictDetectorTest : BasePlatformTestCase() {\n    \n    private lateinit var detector: ConflictDetector\n    \n    override fun setUp() {\n        super.setUp()\n        detector = ConflictDetector(project)\n    }\n    \n    @Test\n    fun `captureSnapshot stores file state`() {\n        createFile(\"test.kt\", \"content\")\n        \n        detector.captureSnapshot(\"test.kt\")\n        \n        assertTrue(detector.hasSnapshot(\"test.kt\"))\n    }\n    \n    @Test\n    fun `hasConflict returns false when file unchanged`() {\n        createFile(\"test.kt\", \"content\")\n        detector.captureSnapshot(\"test.kt\")\n        val diff = FileDiff(\"test.kt\", \"content\", \"new\", FileDiff.Operation.MODIFY)\n        \n        val result = detector.hasConflict(diff)\n        \n        assertFalse(result)\n    }\n    \n    @Test\n    fun `hasConflict returns true when file modified`() {\n        createFile(\"test.kt\", \"original\")\n        detector.captureSnapshot(\"test.kt\")\n        // Modify file after snapshot\n        modifyFile(\"test.kt\", \"modified externally\")\n        val diff = FileDiff(\"test.kt\", \"original\", \"new\", FileDiff.Operation.MODIFY)\n        \n        val result = detector.hasConflict(diff)\n        \n        assertTrue(result)\n    }\n    \n    @Test\n    fun `hasConflict returns false for new file`() {\n        val diff = FileDiff(\"new.kt\", \"\", \"content\", FileDiff.Operation.CREATE)\n        \n        val result = detector.hasConflict(diff)\n        \n        assertFalse(result)\n    }\n    \n    @Test\n    fun `hasConflict returns false when no snapshot`() {\n        createFile(\"test.kt\", \"content\")\n        val diff = FileDiff(\"test.kt\", \"content\", \"new\", FileDiff.Operation.MODIFY)\n        \n        val result = detector.hasConflict(diff)\n        \n        assertFalse(result)\n    }\n    \n    @Test\n    fun `clearSnapshots removes all snapshots`() {\n        detector.captureSnapshot(\"a.kt\")\n        detector.captureSnapshot(\"b.kt\")\n        \n        detector.clearSnapshots()\n        \n        assertFalse(detector.hasSnapshot(\"a.kt\"))\n        assertFalse(detector.hasSnapshot(\"b.kt\"))\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Snapshot capture tests\n- [ ] Conflict detection tests\n- [ ] Edge case tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:24:09.127021+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:24:09.127021+07:00","labels":["conflicts","diff","tdd","test"],"dependencies":[{"issue_id":"cb-blv.9","depends_on_id":"cb-blv","type":"parent-child","created_at":"2026-01-24T09:24:09.127734+07:00","created_by":"mochadwi"}]}
{"id":"cb-u20","title":"Phase 5: Session Persistence \u0026 Polish","description":"## Overview\nImplement session persistence across IDE restarts and polish the user experience with proper error handling, notifications, and UI refinements.\n\n## Goals\n- Persist session metadata (IDs, titles, timestamps)\n- Reload sessions on project open\n- Polish UI with proper styling and feedback\n- Comprehensive error handling with notifications\n- Reconnect functionality for backend failures\n\n## Success Criteria\n- Sessions survive IDE restart\n- User can rename/delete sessions\n- Error notifications are clear and actionable\n- Reconnect button works after backend failure\n- UI feels polished and responsive\n\n## Technical Scope\n\n### Session Persistence\n```kotlin\n@State(\n    name = \"CodebuffSessionState\",\n    storages = [Storage(\"codebuff-sessions.xml\")]\n)\nclass SessionManager : PersistentStateComponent\u003cSessionManager.State\u003e {\n    data class State(\n        var sessions: MutableList\u003cSessionInfo\u003e = mutableListOf(),\n        var activeSessionId: String? = null\n    )\n    \n    data class SessionInfo(\n        val id: String,\n        var title: String,\n        val createdAt: Long,\n        var lastActivityAt: Long\n    )\n}\n```\n\n### Error Handling\n- NotificationGroup for Codebuff notifications\n- Balloon notifications for transient errors\n- Sticky notifications for critical errors\n- Retry/reconnect actions in notifications\n\n### UI Polish\n- Loading indicators during streaming\n- Proper disable states for buttons\n- Keyboard shortcuts working\n- Consistent styling with IDE theme\n- Accessibility considerations\n\n### Session Management UI\n- Session list with rename/delete context menu\n- \"New Session\" button\n- Auto-title based on first prompt\n- Session switching\n\n## Effort Estimate\nM (3-5 days)\n\n## Reference\n- [IntelliJ Persisting State](https://plugins.jetbrains.com/docs/intellij/persisting-state-of-components.html)\n- [IntelliJ Notifications](https://plugins.jetbrains.com/docs/intellij/notifications.html)","status":"open","priority":2,"issue_type":"epic","owner":"moch.iqbaldc@gmail.com","created_at":"2026-01-24T01:59:55.938422+07:00","created_by":"mochadwi","updated_at":"2026-01-24T01:59:55.938422+07:00","labels":["epic","persistence","phase-5","polish"],"dependencies":[{"issue_id":"cb-u20","depends_on_id":"cb-blv","type":"blocks","created_at":"2026-01-24T09:26:37.549218+07:00","created_by":"mochadwi"}]}
{"id":"cb-u20.1","title":"Implement session persistence with PersistentStateComponent","description":"Persist session metadata across IDE restarts.\n\n## Files\n- Update: src/main/kotlin/com/codebuff/intellij/services/SessionManager.kt\n\n## Implementation\n```kotlin\n@State(\n    name = \"CodebuffSessionState\",\n    storages = [Storage(\"codebuff-sessions.xml\")]\n)\n@Service(Service.Level.PROJECT)\nclass SessionManager(private val project: Project) : \n    PersistentStateComponent\u003cSessionManager.State\u003e {\n    \n    data class State(\n        var sessions: MutableList\u003cSessionInfo\u003e = mutableListOf(),\n        var activeSessionId: String? = null\n    )\n    \n    @Serializable\n    data class SessionInfo(\n        val id: String,\n        var title: String,\n        val createdAt: Long,\n        var lastActivityAt: Long,\n        var messageCount: Int = 0\n    )\n    \n    private var state = State()\n    \n    override fun getState(): State = state\n    \n    override fun loadState(state: State) {\n        this.state = state\n        // Restore active session if exists\n        state.activeSessionId?.let { id -\u003e\n            activeSession = state.sessions.find { it.id == id }\n        }\n    }\n    \n    var activeSession: SessionInfo? = null\n        private set\n    \n    fun createSession(title: String? = null): SessionInfo {\n        val session = SessionInfo(\n            id = UUID.randomUUID().toString(),\n            title = title ?: \"New Session\",\n            createdAt = System.currentTimeMillis(),\n            lastActivityAt = System.currentTimeMillis()\n        )\n        state.sessions.add(session)\n        setActiveSession(session)\n        return session\n    }\n    \n    fun setActiveSession(session: SessionInfo) {\n        activeSession = session\n        state.activeSessionId = session.id\n    }\n    \n    fun deleteSession(sessionId: String) {\n        state.sessions.removeIf { it.id == sessionId }\n        if (state.activeSessionId == sessionId) {\n            activeSession = state.sessions.firstOrNull()\n            state.activeSessionId = activeSession?.id\n        }\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Sessions persist across IDE restarts\n- [ ] Active session restored\n- [ ] Session list maintained\n- [ ] Delete works correctly","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":150,"created_at":"2026-01-24T02:03:34.017359+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:03:34.017359+07:00","labels":["persistence","sessions"],"dependencies":[{"issue_id":"cb-u20.1","depends_on_id":"cb-u20","type":"parent-child","created_at":"2026-01-24T02:03:34.01809+07:00","created_by":"mochadwi"},{"issue_id":"cb-u20.1","depends_on_id":"cb-u20.6","type":"blocks","created_at":"2026-01-24T09:26:24.549525+07:00","created_by":"mochadwi"}]}
{"id":"cb-u20.10","title":"Write tests for UI loading states","description":"## TDD: Test First\n\nWrite tests for UI loading states and feedback.\n\n## Test Cases\n\n```kotlin\nclass UILoadingStatesTest : BasePlatformTestCase() {\n    \n    private lateinit var chatPanel: ChatPanel\n    \n    override fun setUp() {\n        super.setUp()\n        chatPanel = ChatPanel(project)\n    }\n    \n    @Test\n    fun `loading indicator hidden by default`() {\n        assertFalse(chatPanel.loadingIndicator.isVisible)\n    }\n    \n    @Test\n    fun `setLoading true shows indicator`() {\n        chatPanel.setLoading(true)\n        \n        assertTrue(chatPanel.loadingIndicator.isVisible)\n    }\n    \n    @Test\n    fun `setLoading false hides indicator`() {\n        chatPanel.setLoading(true)\n        chatPanel.setLoading(false)\n        \n        assertFalse(chatPanel.loadingIndicator.isVisible)\n    }\n    \n    @Test\n    fun `input disabled during loading`() {\n        chatPanel.setLoading(true)\n        \n        assertFalse(chatPanel.inputField.isEnabled)\n    }\n    \n    @Test\n    fun `input enabled when not loading`() {\n        chatPanel.setLoading(false)\n        \n        assertTrue(chatPanel.inputField.isEnabled)\n    }\n    \n    @Test\n    fun `send button disabled during loading`() {\n        chatPanel.setLoading(true)\n        \n        assertFalse(chatPanel.sendButton.isEnabled)\n    }\n    \n    @Test\n    fun `status label shows Ready when idle`() {\n        chatPanel.setLoading(false)\n        \n        assertEquals(\"Ready\", chatPanel.statusLabel.text)\n    }\n    \n    @Test\n    fun `status label shows Thinking during token stream`() {\n        chatPanel.onToken(TokenEvent(\"s1\", \"text\"))\n        \n        assertTrue(chatPanel.statusLabel.text.contains(\"Generating\") || \n                   chatPanel.statusLabel.text.contains(\"Thinking\"))\n    }\n    \n    @Test\n    fun `status shows tool name during tool call`() {\n        chatPanel.onToolCall(ToolCallEvent(\"s1\", \"read_files\", JsonObject()))\n        \n        assertTrue(chatPanel.statusLabel.text.contains(\"read_files\"))\n    }\n    \n    @Test\n    fun `cancel button visible during loading`() {\n        chatPanel.setLoading(true)\n        \n        assertTrue(chatPanel.cancelButton.isVisible)\n    }\n    \n    @Test\n    fun `cancel button hidden when idle`() {\n        chatPanel.setLoading(false)\n        \n        assertFalse(chatPanel.cancelButton.isVisible)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Loading indicator visibility tests\n- [ ] Input state tests\n- [ ] Status label tests\n- [ ] Cancel button visibility tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:24:53.57536+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:24:53.57536+07:00","labels":["polish","tdd","test","ui"],"dependencies":[{"issue_id":"cb-u20.10","depends_on_id":"cb-u20","type":"parent-child","created_at":"2026-01-24T09:24:53.576886+07:00","created_by":"mochadwi"}]}
{"id":"cb-u20.2","title":"Create session management UI","description":"UI for managing sessions (list, rename, delete).\n\n## Files\n- Update: src/main/kotlin/com/codebuff/intellij/ui/SessionPanel.kt\n\n## Implementation\n```kotlin\nclass SessionPanel(private val project: Project) : JPanel(BorderLayout()) {\n    \n    private val sessionManager = project.service\u003cSessionManager\u003e()\n    private val listModel = DefaultListModel\u003cSessionInfo\u003e()\n    private val sessionList = JBList(listModel)\n    \n    init {\n        border = IdeBorderFactory.createTitledBorder(\"Sessions\")\n        \n        sessionList.cellRenderer = SessionListCellRenderer()\n        sessionList.addListSelectionListener { \n            if (!it.valueIsAdjusting) {\n                sessionList.selectedValue?.let { session -\u003e\n                    sessionManager.setActiveSession(session)\n                    refreshChat()\n                }\n            }\n        }\n        \n        // Context menu for rename/delete\n        sessionList.addMouseListener(object : PopupHandler() {\n            override fun invokePopup(comp: Component, x: Int, y: Int) {\n                val index = sessionList.locationToIndex(Point(x, y))\n                if (index \u003e= 0) {\n                    sessionList.selectedIndex = index\n                    createPopupMenu().show(comp, x, y)\n                }\n            }\n        })\n        \n        add(JBScrollPane(sessionList), BorderLayout.CENTER)\n        add(createNewSessionButton(), BorderLayout.SOUTH)\n        \n        loadSessions()\n    }\n    \n    private fun createPopupMenu(): JPopupMenu {\n        return JBPopupMenu().apply {\n            add(JMenuItem(\"Rename\").apply {\n                addActionListener { renameSession() }\n            })\n            add(JMenuItem(\"Delete\").apply {\n                addActionListener { deleteSession() }\n            })\n        }\n    }\n    \n    private fun renameSession() {\n        val session = sessionList.selectedValue ?: return\n        val newTitle = Messages.showInputDialog(\n            project, \"Enter new session name:\", \"Rename Session\",\n            null, session.title, null\n        )\n        if (!newTitle.isNullOrBlank()) {\n            session.title = newTitle\n            listModel.set(sessionList.selectedIndex, session)\n        }\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Session list displays correctly\n- [ ] Clicking switches session\n- [ ] Rename via context menu works\n- [ ] Delete via context menu works\n- [ ] New session button works","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":150,"created_at":"2026-01-24T02:03:34.103518+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:03:34.103518+07:00","labels":["sessions","ui"],"dependencies":[{"issue_id":"cb-u20.2","depends_on_id":"cb-u20","type":"parent-child","created_at":"2026-01-24T02:03:34.104207+07:00","created_by":"mochadwi"},{"issue_id":"cb-u20.2","depends_on_id":"cb-u20.7","type":"blocks","created_at":"2026-01-24T09:26:24.610302+07:00","created_by":"mochadwi"}]}
{"id":"cb-u20.3","title":"Implement notification system","description":"Notifications for errors, status updates, and actions.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/notifications/CodebuffNotifications.kt\n\n## Implementation\n```kotlin\nobject CodebuffNotifications {\n    \n    private val NOTIFICATION_GROUP = NotificationGroupManager.getInstance()\n        .getNotificationGroup(\"Codebuff\")\n    \n    fun notifyError(project: Project, message: String, action: AnAction? = null) {\n        val notification = NOTIFICATION_GROUP.createNotification(\n            \"Codebuff Error\",\n            message,\n            NotificationType.ERROR\n        )\n        action?.let { notification.addAction(it) }\n        notification.notify(project)\n    }\n    \n    fun notifyInfo(project: Project, message: String) {\n        NOTIFICATION_GROUP.createNotification(\n            message,\n            NotificationType.INFORMATION\n        ).notify(project)\n    }\n    \n    fun notifyBackendDisconnected(project: Project) {\n        val reconnectAction = object : AnAction(\"Reconnect\") {\n            override fun actionPerformed(e: AnActionEvent) {\n                e.project?.service\u003cCodebuffProjectService\u003e()?.reconnect()\n            }\n        }\n        \n        notifyError(\n            project,\n            \"Codebuff backend disconnected unexpectedly.\",\n            reconnectAction\n        )\n    }\n    \n    fun notifyDiffReady(project: Project, fileCount: Int) {\n        val reviewAction = object : AnAction(\"Review Changes\") {\n            override fun actionPerformed(e: AnActionEvent) {\n                e.project?.service\u003cDiffViewerService\u003e()?.showPendingDiffs()\n            }\n        }\n        \n        NOTIFICATION_GROUP.createNotification(\n            \"Codebuff\",\n            \" file(s) ready for review\",\n            NotificationType.INFORMATION\n        ).addAction(reviewAction).notify(project)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Error notifications show correctly\n- [ ] Reconnect action works\n- [ ] Info notifications non-intrusive\n- [ ] Action buttons work in notifications","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T02:03:34.192831+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:03:34.192831+07:00","labels":["notifications","ux"],"dependencies":[{"issue_id":"cb-u20.3","depends_on_id":"cb-u20","type":"parent-child","created_at":"2026-01-24T02:03:34.193521+07:00","created_by":"mochadwi"},{"issue_id":"cb-u20.3","depends_on_id":"cb-u20.8","type":"blocks","created_at":"2026-01-24T09:26:24.666605+07:00","created_by":"mochadwi"}]}
{"id":"cb-u20.4","title":"Implement reconnect functionality","description":"Handle backend disconnection and reconnection.\n\n## Implementation\n```kotlin\nclass CliBackendClient(...) {\n    \n    private var reconnectAttempts = 0\n    private val maxReconnectAttempts = 5\n    private val baseReconnectDelay = 1000L // 1 second\n    \n    private suspend fun handleDisconnect(error: Exception?) {\n        isConnected = false\n        \n        if (reconnectAttempts \u003e= maxReconnectAttempts) {\n            CodebuffNotifications.notifyBackendDisconnected(project)\n            return\n        }\n        \n        val delay = baseReconnectDelay * (1 shl reconnectAttempts)\n        reconnectAttempts++\n        \n        delay(delay)\n        \n        try {\n            connect()\n            reconnectAttempts = 0\n            CodebuffNotifications.notifyInfo(project, \"Codebuff reconnected\")\n        } catch (e: Exception) {\n            handleDisconnect(e)\n        }\n    }\n    \n    fun reconnect() {\n        reconnectAttempts = 0\n        scope.launch {\n            disconnect()\n            connect()\n        }\n    }\n}\n```\n\n## Features\n- Exponential backoff (1s, 2s, 4s, 8s, 16s)\n- Max 5 attempts before giving up\n- Manual reconnect button\n- Status indicator in UI\n\n## Acceptance Criteria\n- [ ] Auto-reconnect on disconnect\n- [ ] Exponential backoff works\n- [ ] Manual reconnect works\n- [ ] Status shown in UI","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T02:03:34.285135+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:03:34.285135+07:00","labels":["backend","reliability"],"dependencies":[{"issue_id":"cb-u20.4","depends_on_id":"cb-u20","type":"parent-child","created_at":"2026-01-24T02:03:34.285849+07:00","created_by":"mochadwi"},{"issue_id":"cb-u20.4","depends_on_id":"cb-u20.9","type":"blocks","created_at":"2026-01-24T09:26:24.726582+07:00","created_by":"mochadwi"}]}
{"id":"cb-u20.5","title":"Polish UI with loading states and feedback","description":"Add loading indicators, proper disable states, and visual feedback.\n\n## Implementation\n```kotlin\nclass ChatPanel(...) {\n    \n    private val loadingIndicator = JProgressBar().apply {\n        isIndeterminate = true\n        isVisible = false\n    }\n    \n    private val statusLabel = JBLabel().apply {\n        foreground = JBColor.GRAY\n    }\n    \n    fun setLoading(loading: Boolean) {\n        loadingIndicator.isVisible = loading\n        inputField.isEnabled = !loading\n        sendButton.isEnabled = !loading\n        cancelButton.isVisible = loading\n        \n        statusLabel.text = if (loading) \"Thinking...\" else \"Ready\"\n    }\n    \n    override fun onToken(event: TokenEvent) {\n        statusLabel.text = \"Generating...\"\n        // ...\n    }\n    \n    override fun onToolCall(event: ToolCallEvent) {\n        statusLabel.text = \"Using ${event.tool}...\"\n        // ...\n    }\n}\n```\n\n## Polish Items\n- Loading spinner during request\n- Disable input during streaming\n- Status text (Ready, Thinking, Generating, Using tool...)\n- Smooth scrolling for new content\n- Consistent spacing and margins\n- Theme-aware colors\n\n## Acceptance Criteria\n- [ ] Loading indicator visible during requests\n- [ ] Input disabled during streaming\n- [ ] Status updates smoothly\n- [ ] UI feels responsive\n- [ ] Works in light and dark themes","status":"open","priority":2,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":120,"created_at":"2026-01-24T02:03:34.384951+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:03:34.384951+07:00","labels":["polish","ui"],"dependencies":[{"issue_id":"cb-u20.5","depends_on_id":"cb-u20","type":"parent-child","created_at":"2026-01-24T02:03:34.385871+07:00","created_by":"mochadwi"},{"issue_id":"cb-u20.5","depends_on_id":"cb-u20.10","type":"blocks","created_at":"2026-01-24T09:26:24.786167+07:00","created_by":"mochadwi"}]}
{"id":"cb-u20.6","title":"Write tests for session persistence","description":"## TDD: Test First\n\nWrite tests for session persistence before implementing.\n\n## Test Cases\n\n```kotlin\nclass SessionPersistenceTest : BasePlatformTestCase() {\n    \n    private lateinit var sessionManager: SessionManager\n    \n    override fun setUp() {\n        super.setUp()\n        sessionManager = project.service\u003cSessionManager\u003e()\n    }\n    \n    @Test\n    fun `implements PersistentStateComponent`() {\n        assertTrue(sessionManager is PersistentStateComponent\u003c*\u003e)\n    }\n    \n    @Test\n    fun `getState returns current state`() {\n        val state = sessionManager.state\n        \n        assertNotNull(state)\n    }\n    \n    @Test\n    fun `loadState restores sessions`() {\n        val savedState = SessionManager.State(\n            sessions = mutableListOf(\n                SessionManager.SessionInfo(\"id-1\", \"Session 1\", 1000L, 2000L)\n            ),\n            activeSessionId = \"id-1\"\n        )\n        \n        sessionManager.loadState(savedState)\n        \n        assertEquals(1, sessionManager.getSessions().size)\n        assertEquals(\"id-1\", sessionManager.activeSession?.id)\n    }\n    \n    @Test\n    fun `sessions persist across reload`() {\n        sessionManager.createSession(\"Test Session\")\n        val originalState = sessionManager.state\n        \n        // Simulate reload\n        sessionManager.loadState(originalState)\n        \n        assertEquals(1, sessionManager.getSessions().size)\n    }\n    \n    @Test\n    fun `active session restored on load`() {\n        val session = sessionManager.createSession(\"Active\")\n        sessionManager.setActiveSession(session)\n        val state = sessionManager.state\n        \n        sessionManager.loadState(state)\n        \n        assertEquals(session.id, sessionManager.activeSession?.id)\n    }\n    \n    @Test\n    fun `session info contains all required fields`() {\n        val session = sessionManager.createSession(\"Test\")\n        \n        assertNotNull(session.id)\n        assertNotNull(session.title)\n        assertTrue(session.createdAt \u003e 0)\n        assertTrue(session.lastActivityAt \u003e 0)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] State serialization tests\n- [ ] State restoration tests\n- [ ] Active session persistence tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:24:53.176902+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:24:53.176902+07:00","labels":["persistence","sessions","tdd","test"],"dependencies":[{"issue_id":"cb-u20.6","depends_on_id":"cb-u20","type":"parent-child","created_at":"2026-01-24T09:24:53.190784+07:00","created_by":"mochadwi"}]}
{"id":"cb-u20.7","title":"Write tests for session management UI","description":"## TDD: Test First\n\nWrite tests for session management UI.\n\n## Test Cases\n\n```kotlin\nclass SessionPanelTest : BasePlatformTestCase() {\n    \n    private lateinit var panel: SessionPanel\n    private lateinit var sessionManager: SessionManager\n    \n    override fun setUp() {\n        super.setUp()\n        sessionManager = project.service\u003cSessionManager\u003e()\n        panel = SessionPanel(project)\n    }\n    \n    @Test\n    fun `displays existing sessions`() {\n        sessionManager.createSession(\"Session 1\")\n        sessionManager.createSession(\"Session 2\")\n        \n        panel.refresh()\n        \n        val list = panel.findComponent\u003cJBList\u003c*\u003e\u003e()\n        assertEquals(2, list?.model?.size)\n    }\n    \n    @Test\n    fun `selecting session updates active session`() {\n        val session = sessionManager.createSession(\"Test\")\n        panel.refresh()\n        \n        panel.selectSession(session.id)\n        \n        assertEquals(session.id, sessionManager.activeSession?.id)\n    }\n    \n    @Test\n    fun `new session button creates session`() {\n        val initialCount = sessionManager.getSessions().size\n        \n        panel.onNewSession()\n        \n        assertEquals(initialCount + 1, sessionManager.getSessions().size)\n    }\n    \n    @Test\n    fun `rename updates session title`() {\n        val session = sessionManager.createSession(\"Original\")\n        \n        panel.renameSession(session.id, \"Renamed\")\n        \n        assertEquals(\"Renamed\", sessionManager.getSession(session.id)?.title)\n    }\n    \n    @Test\n    fun `delete removes session`() {\n        val session = sessionManager.createSession(\"ToDelete\")\n        \n        panel.deleteSession(session.id)\n        \n        assertNull(sessionManager.getSession(session.id))\n    }\n    \n    @Test\n    fun `delete active session switches to another`() {\n        val session1 = sessionManager.createSession(\"One\")\n        val session2 = sessionManager.createSession(\"Two\")\n        sessionManager.setActiveSession(session1)\n        \n        panel.deleteSession(session1.id)\n        \n        assertEquals(session2.id, sessionManager.activeSession?.id)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Session list display tests\n- [ ] Selection behavior tests\n- [ ] CRUD operation tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:24:53.285851+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:24:53.285851+07:00","labels":["sessions","tdd","test","ui"],"dependencies":[{"issue_id":"cb-u20.7","depends_on_id":"cb-u20","type":"parent-child","created_at":"2026-01-24T09:24:53.286902+07:00","created_by":"mochadwi"}]}
{"id":"cb-u20.8","title":"Write tests for notification system","description":"## TDD: Test First\n\nWrite tests for notification system.\n\n## Test Cases\n\n```kotlin\nclass CodebuffNotificationsTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `notification group is registered`() {\n        val group = NotificationGroupManager.getInstance()\n            .getNotificationGroup(\"Codebuff\")\n        \n        assertNotNull(group)\n    }\n    \n    @Test\n    fun `notifyError creates error notification`() {\n        var capturedNotification: Notification? = null\n        val listener = object : Notifications {\n            override fun notify(notification: Notification) {\n                capturedNotification = notification\n            }\n        }\n        project.messageBus.connect().subscribe(Notifications.TOPIC, listener)\n        \n        CodebuffNotifications.notifyError(project, \"Test error\")\n        \n        assertEquals(NotificationType.ERROR, capturedNotification?.type)\n    }\n    \n    @Test\n    fun `notifyError includes action when provided`() {\n        val action = object : AnAction(\"Retry\") {\n            override fun actionPerformed(e: AnActionEvent) {}\n        }\n        \n        val notification = CodebuffNotifications.createError(\n            \"Error message\",\n            action\n        )\n        \n        assertTrue(notification.actions.isNotEmpty())\n    }\n    \n    @Test\n    fun `notifyInfo creates info notification`() {\n        var capturedNotification: Notification? = null\n        val listener = object : Notifications {\n            override fun notify(notification: Notification) {\n                capturedNotification = notification\n            }\n        }\n        project.messageBus.connect().subscribe(Notifications.TOPIC, listener)\n        \n        CodebuffNotifications.notifyInfo(project, \"Info message\")\n        \n        assertEquals(NotificationType.INFORMATION, capturedNotification?.type)\n    }\n    \n    @Test\n    fun `notifyBackendDisconnected includes reconnect action`() {\n        val notification = CodebuffNotifications.createBackendDisconnected()\n        \n        assertTrue(notification.actions.any { it.templatePresentation.text == \"Reconnect\" })\n    }\n    \n    @Test\n    fun `notifyDiffReady includes review action`() {\n        val notification = CodebuffNotifications.createDiffReady(3)\n        \n        assertTrue(notification.actions.any { it.templatePresentation.text == \"Review Changes\" })\n        assertTrue(notification.content.contains(\"3\"))\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Notification group registration\n- [ ] Error notification tests\n- [ ] Action attachment tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":60,"created_at":"2026-01-24T09:24:53.385809+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:24:53.385809+07:00","labels":["notifications","tdd","test","ux"],"dependencies":[{"issue_id":"cb-u20.8","depends_on_id":"cb-u20","type":"parent-child","created_at":"2026-01-24T09:24:53.387343+07:00","created_by":"mochadwi"}]}
{"id":"cb-u20.9","title":"Write tests for reconnect functionality","description":"## TDD: Test First\n\nWrite tests for reconnect functionality.\n\n## Test Cases\n\n```kotlin\nclass ReconnectFunctionalityTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `exponential backoff calculates correct delays`() {\n        val client = CliBackendClient(project, \"codebuff\")\n        \n        assertEquals(1000L, client.calculateBackoffDelay(0))\n        assertEquals(2000L, client.calculateBackoffDelay(1))\n        assertEquals(4000L, client.calculateBackoffDelay(2))\n        assertEquals(8000L, client.calculateBackoffDelay(3))\n    }\n    \n    @Test\n    fun `backoff capped at max delay`() {\n        val client = CliBackendClient(project, \"codebuff\")\n        client.maxBackoffDelay = 10000L\n        \n        val delay = client.calculateBackoffDelay(10)\n        \n        assertEquals(10000L, delay)\n    }\n    \n    @Test\n    fun `reconnect resets attempt counter`() {\n        val client = CliBackendClient(project, \"codebuff\")\n        client.reconnectAttempts = 3\n        \n        runBlocking { client.reconnect() }\n        \n        assertEquals(0, client.reconnectAttempts)\n    }\n    \n    @Test\n    fun `max attempts triggers notification`() {\n        var notificationShown = false\n        // Mock notification system\n        \n        val client = CliBackendClient(project, \"echo\")\n        client.maxReconnectAttempts = 1\n        \n        runBlocking {\n            client.connect()\n            client.simulateCrash()\n            client.simulateCrash() // Exceeds max\n            delay(3000)\n        }\n        \n        // Verify notification was shown\n        assertTrue(notificationShown)\n    }\n    \n    @Test\n    fun `successful reconnect resets backoff`() {\n        val client = CliBackendClient(project, \"echo\")\n        client.reconnectAttempts = 3\n        \n        runBlocking {\n            client.disconnect()\n            client.connect()\n        }\n        \n        assertEquals(0, client.reconnectAttempts)\n    }\n    \n    @Test\n    fun `reconnect called after disconnect event`() {\n        var reconnectCalled = false\n        val client = object : CliBackendClient(project, \"echo\") {\n            override fun reconnect() {\n                reconnectCalled = true\n                super.reconnect()\n            }\n        }\n        \n        runBlocking {\n            client.connect()\n            client.simulateCrash()\n            delay(2000)\n        }\n        \n        assertTrue(reconnectCalled)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Backoff calculation tests\n- [ ] Max attempts handling tests\n- [ ] Reconnect behavior tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:24:53.481574+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:24:53.481574+07:00","labels":["backend","reliability","tdd","test"],"dependencies":[{"issue_id":"cb-u20.9","depends_on_id":"cb-u20","type":"parent-child","created_at":"2026-01-24T09:24:53.482726+07:00","created_by":"mochadwi"}]}
{"id":"cb-vnl","title":"Phase 1: Project Scaffolding \u0026 UI Shell","description":"## Overview\nSet up the IntelliJ plugin project with Gradle Kotlin DSL build system, create the basic ToolWindow UI shell, and implement service skeletons.\n\n## Goals\n- Working plugin that can run in IntelliJ sandbox IDE\n- Basic ToolWindow with placeholder chat UI\n- Service layer skeleton (no backend yet)\n- Editor context menu actions (UI only)\n\n## Success Criteria\n- `./gradlew runIde` launches IntelliJ with plugin loaded\n- Codebuff ToolWindow visible in View â†’ Tool Windows\n- Actions appear in editor context menu\n- All code compiles without errors\n\n## Technical Scope\n- Gradle Kotlin DSL configuration with IntelliJ Platform Plugin\n- plugin.xml with extension points\n- Service interfaces and stubs\n- Basic Swing/IntelliJ UI components\n\n## Effort Estimate\nS-M (2-4 days)\n\n## Reference\n- [OpenCode_UI plugin.xml](https://github.com/LaiZhou/OpenCode_UI/blob/main/src/main/resources/META-INF/plugin.xml)\n- [IntelliJ Platform SDK - Getting Started](https://plugins.jetbrains.com/docs/intellij/getting-started.html)","status":"open","priority":0,"issue_type":"epic","owner":"moch.iqbaldc@gmail.com","created_at":"2026-01-24T01:58:54.619195+07:00","created_by":"mochadwi","updated_at":"2026-01-24T01:58:54.619195+07:00","labels":["epic","phase-1"]}
{"id":"cb-vnl.1","title":"Setup Gradle Kotlin DSL build configuration","description":"Create the initial Gradle build configuration for IntelliJ Platform Plugin development.\n\n## Files to Create\n- build.gradle.kts\n- settings.gradle.kts\n- gradle.properties\n- gradle/wrapper/* (gradle wrapper)\n\n## Configuration\n```kotlin\nplugins {\n    id(\"org.jetbrains.kotlin.jvm\") version \"2.0.21\"\n    id(\"org.jetbrains.intellij.platform\") version \"2.2.1\"\n}\n\nkotlin {\n    jvmToolchain(17)\n}\n\ndependencies {\n    intellijPlatform {\n        intellijIdeaCommunity(\"2024.2\")\n        bundledPlugin(\"com.intellij.java\")\n        instrumentationTools()\n    }\n    implementation(\"com.squareup.okhttp3:okhttp:4.12.0\")\n    implementation(\"org.jetbrains.kotlinx:kotlinx-coroutines-core:1.9.0\")\n    implementation(\"com.google.code.gson:gson:2.11.0\")\n}\n```\n\n## Acceptance Criteria\n- [ ] `./gradlew build` succeeds\n- [ ] `./gradlew runIde` launches IntelliJ sandbox\n- [ ] Kotlin and IntelliJ Platform dependencies resolve","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":120,"created_at":"2026-01-24T02:00:48.855669+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:00:48.855669+07:00","labels":["gradle","setup"],"dependencies":[{"issue_id":"cb-vnl.1","depends_on_id":"cb-vnl","type":"parent-child","created_at":"2026-01-24T02:00:48.856534+07:00","created_by":"mochadwi"},{"issue_id":"cb-vnl.1","depends_on_id":"cb-vnl.7","type":"blocks","created_at":"2026-01-24T09:26:00.818199+07:00","created_by":"mochadwi"},{"issue_id":"cb-vnl.1","depends_on_id":"cb-vnl.13","type":"blocks","created_at":"2026-01-24T10:53:15.880537+07:00","created_by":"mochadwi"}]}
{"id":"cb-vnl.10","title":"Write tests for service layer skeletons","description":"## TDD: Test First\n\nWrite tests for service interfaces and basic structure.\n\n## Test Cases\n\n```kotlin\nclass CodebuffProjectServiceTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `service is registered and retrievable`() {\n        val service = project.service\u003cCodebuffProjectService\u003e()\n        assertNotNull(service)\n    }\n    \n    @Test\n    fun `service implements Disposable`() {\n        val service = project.service\u003cCodebuffProjectService\u003e()\n        assertTrue(service is Disposable)\n    }\n    \n    @Test\n    fun `service provides session manager`() {\n        val service = project.service\u003cCodebuffProjectService\u003e()\n        assertNotNull(service.sessionManager)\n    }\n}\n\nclass SessionManagerTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `session manager is registered`() {\n        val manager = project.service\u003cSessionManager\u003e()\n        assertNotNull(manager)\n    }\n    \n    @Test\n    fun `can create new session`() {\n        val manager = project.service\u003cSessionManager\u003e()\n        val session = manager.createSession()\n        assertNotNull(session)\n        assertNotNull(session.id)\n    }\n}\n\nclass BackendClientTest {\n    \n    @Test\n    fun `BackendClient interface defines required methods`() {\n        // Verify interface contract via reflection\n        val methods = BackendClient::class.java.declaredMethods.map { it.name }\n        assertTrue(methods.contains(\"connect\"))\n        assertTrue(methods.contains(\"disconnect\"))\n        assertTrue(methods.contains(\"sendMessage\"))\n        assertTrue(methods.contains(\"cancel\"))\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Service registration tests\n- [ ] Interface contract tests\n- [ ] Basic functionality skeleton tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:21:44.651946+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:21:44.651946+07:00","labels":["architecture","services","tdd","test"],"dependencies":[{"issue_id":"cb-vnl.10","depends_on_id":"cb-vnl","type":"parent-child","created_at":"2026-01-24T09:21:44.652591+07:00","created_by":"mochadwi"}]}
{"id":"cb-vnl.11","title":"Write tests for editor context actions","description":"## TDD: Test First\n\nWrite tests for editor actions before implementing.\n\n## Test Cases\n\n```kotlin\nclass OpenToolWindowActionTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `action is available from action manager`() {\n        val action = ActionManager.getInstance()\n            .getAction(\"Codebuff.OpenToolWindow\")\n        assertNotNull(action)\n    }\n    \n    @Test\n    fun `action performs without error`() {\n        val action = OpenToolWindowAction()\n        val event = createTestEvent()\n        \n        assertDoesNotThrow { action.actionPerformed(event) }\n    }\n}\n\nclass SendSelectionActionTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `action is disabled when no selection`() {\n        val action = SendSelectionAction()\n        val event = createEventWithoutSelection()\n        \n        action.update(event)\n        \n        assertFalse(event.presentation.isEnabled)\n    }\n    \n    @Test\n    fun `action is enabled when text is selected`() {\n        val action = SendSelectionAction()\n        val event = createEventWithSelection(\"selected text\")\n        \n        action.update(event)\n        \n        assertTrue(event.presentation.isEnabled)\n    }\n    \n    @Test\n    fun `action opens tool window on perform`() {\n        val action = SendSelectionAction()\n        val event = createEventWithSelection(\"test\")\n        \n        action.actionPerformed(event)\n        \n        val toolWindow = ToolWindowManager.getInstance(project)\n            .getToolWindow(\"Codebuff\")\n        assertTrue(toolWindow?.isVisible == true)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Action registration tests\n- [ ] Enable/disable state tests\n- [ ] Action behavior tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":60,"created_at":"2026-01-24T09:21:44.748961+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:21:44.748961+07:00","labels":["actions","editor","tdd","test"],"dependencies":[{"issue_id":"cb-vnl.11","depends_on_id":"cb-vnl","type":"parent-child","created_at":"2026-01-24T09:21:44.74963+07:00","created_by":"mochadwi"}]}
{"id":"cb-vnl.12","title":"Write tests for plugin icons and resources","description":"## TDD: Test First\n\nWrite tests for resource files existence and validity.\n\n## Test Cases\n\n```kotlin\nclass PluginResourcesTest {\n    \n    @Test\n    fun `codebuff svg icon exists`() {\n        val icon = javaClass.getResource(\"/icons/codebuff.svg\")\n        assertNotNull(icon)\n    }\n    \n    @Test\n    fun `codebuff dark svg icon exists`() {\n        val icon = javaClass.getResource(\"/icons/codebuff_dark.svg\")\n        assertNotNull(icon)\n    }\n    \n    @Test\n    fun `message bundle exists`() {\n        val bundle = javaClass.getResource(\"/messages/CodebuffBundle.properties\")\n        assertNotNull(bundle)\n    }\n    \n    @Test\n    fun `message bundle contains required keys`() {\n        val bundle = ResourceBundle.getBundle(\"messages.CodebuffBundle\")\n        \n        assertNotNull(bundle.getString(\"action.Codebuff.OpenToolWindow.text\"))\n        assertNotNull(bundle.getString(\"toolwindow.title\"))\n    }\n    \n    @Test\n    fun `CodebuffBundle class resolves messages`() {\n        val message = CodebuffBundle.message(\"toolwindow.title\")\n        assertTrue(message.isNotBlank())\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Icon existence tests\n- [ ] Bundle loading tests\n- [ ] Message resolution tests","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":45,"created_at":"2026-01-24T09:21:44.839923+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:21:44.839923+07:00","labels":["i18n","resources","tdd","test"],"dependencies":[{"issue_id":"cb-vnl.12","depends_on_id":"cb-vnl","type":"parent-child","created_at":"2026-01-24T09:21:44.840657+07:00","created_by":"mochadwi"}]}
{"id":"cb-vnl.13","title":"Setup Docker development environment","description":"## Overview\nSet up Docker-based development environment for building and testing the IntelliJ plugin.\n\n## Goals\n- Create Dockerfile with JDK 17 and Gradle\n- Create docker-compose.yml for easy commands\n- Create shell scripts for common operations (build, test, runIde)\n- Document Docker workflow in AGENTS.md\n\n## Deliverables\n- docker/Dockerfile\n- docker-compose.yml\n- scripts/docker-build.sh\n- scripts/docker-test.sh\n- scripts/docker-run-ide.sh (may need X11 forwarding or VNC)\n\n## Technical Notes\n- Use openjdk:17-slim or eclipse-temurin:17 as base\n- Mount project as volume for live updates\n- Cache Gradle dependencies in named volume\n- Consider headless mode for CI vs X11 forwarding for local runIde\n\n## Acceptance Criteria\n- [ ] docker-compose build succeeds\n- [ ] docker-compose run test executes tests\n- [ ] docker-compose run build creates plugin distribution\n- [ ] Gradle cache persists between runs","status":"closed","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","created_at":"2026-01-24T10:53:12.061866+07:00","created_by":"mochadwi","updated_at":"2026-01-24T14:59:01.366568+07:00","closed_at":"2026-01-24T14:59:01.366574+07:00","labels":["docker","infrastructure","setup"],"dependencies":[{"issue_id":"cb-vnl.13","depends_on_id":"cb-vnl","type":"parent-child","created_at":"2026-01-24T10:53:12.063323+07:00","created_by":"mochadwi"}]}
{"id":"cb-vnl.2","title":"Create plugin.xml descriptor","description":"Create the plugin descriptor with all extension points.\n\n## File: src/main/resources/META-INF/plugin.xml\n\n## Extensions to Register\n- ToolWindow (Codebuff panel)\n- Project services\n- Application configurable (settings)\n- Notification group\n- Actions (editor context menu, tools menu)\n\n## Configuration\n```xml\n\u003cidea-plugin\u003e\n    \u003cid\u003ecom.codebuff.intellij\u003c/id\u003e\n    \u003cname\u003eCodebuff\u003c/name\u003e\n    \u003cvendor\u003eCodebuff\u003c/vendor\u003e\n    \u003cdescription\u003eAI coding assistant powered by Codebuff\u003c/description\u003e\n    \n    \u003cdepends\u003ecom.intellij.modules.platform\u003c/depends\u003e\n    \n    \u003cextensions defaultExtensionNs=\"com.intellij\"\u003e\n        \u003ctoolWindow id=\"Codebuff\" \n                    anchor=\"right\" \n                    factoryClass=\"com.codebuff.intellij.ui.CodebuffToolWindowFactory\"\n                    icon=\"/icons/codebuff.svg\"/\u003e\n        \n        \u003cprojectService serviceImplementation=\"com.codebuff.intellij.services.CodebuffProjectService\"/\u003e\n        \u003cprojectService serviceImplementation=\"com.codebuff.intellij.services.SessionManager\"/\u003e\n        \n        \u003capplicationConfigurable \n            parentId=\"tools\"\n            instance=\"com.codebuff.intellij.settings.CodebuffSettingsConfigurable\"\n            id=\"com.codebuff.intellij.settings\"\n            displayName=\"Codebuff\"/\u003e\n            \n        \u003cnotificationGroup id=\"Codebuff\" displayType=\"BALLOON\"/\u003e\n    \u003c/extensions\u003e\n    \n    \u003cactions\u003e\n        \u003caction id=\"Codebuff.OpenToolWindow\" \n                class=\"com.codebuff.intellij.actions.OpenToolWindowAction\"\n                text=\"Open Codebuff\"\n                icon=\"/icons/codebuff.svg\"\u003e\n            \u003ckeyboard-shortcut keymap=\"$default\" first-keystroke=\"ctrl shift C\"/\u003e\n            \u003ckeyboard-shortcut keymap=\"Mac OS X\" first-keystroke=\"meta shift C\"/\u003e\n        \u003c/action\u003e\n        \n        \u003caction id=\"Codebuff.SendSelection\"\n                class=\"com.codebuff.intellij.actions.SendSelectionAction\"\n                text=\"Ask Codebuff About Selection\"\u003e\n            \u003cadd-to-group group-id=\"EditorPopupMenu\" anchor=\"last\"/\u003e\n        \u003c/action\u003e\n    \u003c/actions\u003e\n\u003c/idea-plugin\u003e\n```\n\n## Acceptance Criteria\n- [ ] Plugin loads without XML errors\n- [ ] ToolWindow registered and visible\n- [ ] Actions appear in menus","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T02:00:48.94389+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:00:48.94389+07:00","labels":["plugin-xml","setup"],"dependencies":[{"issue_id":"cb-vnl.2","depends_on_id":"cb-vnl","type":"parent-child","created_at":"2026-01-24T02:00:48.944557+07:00","created_by":"mochadwi"},{"issue_id":"cb-vnl.2","depends_on_id":"cb-vnl.8","type":"blocks","created_at":"2026-01-24T09:26:00.885453+07:00","created_by":"mochadwi"},{"issue_id":"cb-vnl.2","depends_on_id":"cb-vnl.13","type":"blocks","created_at":"2026-01-24T10:53:15.973576+07:00","created_by":"mochadwi"}]}
{"id":"cb-vnl.3","title":"Implement CodebuffToolWindowFactory","description":"Create the ToolWindow factory and basic UI shell.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/ui/CodebuffToolWindowFactory.kt\n- src/main/kotlin/com/codebuff/intellij/ui/ChatPanel.kt\n- src/main/kotlin/com/codebuff/intellij/ui/SessionPanel.kt\n\n## Implementation\n```kotlin\nclass CodebuffToolWindowFactory : ToolWindowFactory {\n    override fun createToolWindowContent(project: Project, toolWindow: ToolWindow) {\n        val contentFactory = ContentFactory.getInstance()\n        val panel = CodebuffMainPanel(project)\n        val content = contentFactory.createContent(panel, \"\", false)\n        toolWindow.contentManager.addContent(content)\n    }\n}\n\nclass CodebuffMainPanel(private val project: Project) : JPanel(BorderLayout()) {\n    private val chatPanel = ChatPanel(project)\n    private val sessionPanel = SessionPanel(project)\n    private val inputField = JBTextField()\n    private val sendButton = JButton(\"Send\")\n    \n    init {\n        // Layout: Sessions on left, Chat in center, Input at bottom\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] ToolWindow opens from View menu\n- [ ] Basic layout visible (placeholder content OK)\n- [ ] Input field and send button present","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":180,"created_at":"2026-01-24T02:00:49.03212+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:00:49.03212+07:00","labels":["toolwindow","ui"],"dependencies":[{"issue_id":"cb-vnl.3","depends_on_id":"cb-vnl","type":"parent-child","created_at":"2026-01-24T02:00:49.032867+07:00","created_by":"mochadwi"},{"issue_id":"cb-vnl.3","depends_on_id":"cb-vnl.9","type":"blocks","created_at":"2026-01-24T09:26:00.945426+07:00","created_by":"mochadwi"},{"issue_id":"cb-vnl.3","depends_on_id":"cb-vnl.13","type":"blocks","created_at":"2026-01-24T10:53:16.062226+07:00","created_by":"mochadwi"}]}
{"id":"cb-vnl.4","title":"Create service layer skeletons","description":"Create the service interfaces and stub implementations.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/services/CodebuffProjectService.kt\n- src/main/kotlin/com/codebuff/intellij/services/SessionManager.kt\n- src/main/kotlin/com/codebuff/intellij/services/ContextCollector.kt\n- src/main/kotlin/com/codebuff/intellij/backend/BackendClient.kt\n\n## Implementation\n```kotlin\n@Service(Service.Level.PROJECT)\nclass CodebuffProjectService(private val project: Project) : Disposable {\n    val sessionManager: SessionManager get() = project.service()\n    \n    fun sendMessage(text: String, context: List\u003cContextItem\u003e) {\n        // TODO: Implement in Phase 2\n    }\n    \n    override fun dispose() {\n        // Cleanup\n    }\n}\n\ninterface BackendClient {\n    suspend fun connect()\n    suspend fun disconnect()\n    suspend fun sendMessage(request: MessageRequest): Flow\u003cBackendEvent\u003e\n    suspend fun cancel(sessionId: String)\n    val isConnected: Boolean\n}\n```\n\n## Acceptance Criteria\n- [ ] Services registered and injectable\n- [ ] No compilation errors\n- [ ] Interfaces define complete contract","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":120,"created_at":"2026-01-24T02:00:49.115917+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:00:49.115917+07:00","labels":["architecture","services"],"dependencies":[{"issue_id":"cb-vnl.4","depends_on_id":"cb-vnl","type":"parent-child","created_at":"2026-01-24T02:00:49.117266+07:00","created_by":"mochadwi"},{"issue_id":"cb-vnl.4","depends_on_id":"cb-vnl.10","type":"blocks","created_at":"2026-01-24T09:26:01.003589+07:00","created_by":"mochadwi"},{"issue_id":"cb-vnl.4","depends_on_id":"cb-vnl.13","type":"blocks","created_at":"2026-01-24T10:53:16.147163+07:00","created_by":"mochadwi"}]}
{"id":"cb-vnl.5","title":"Implement editor context actions","description":"Create actions for editor integration.\n\n## Files\n- src/main/kotlin/com/codebuff/intellij/actions/OpenToolWindowAction.kt\n- src/main/kotlin/com/codebuff/intellij/actions/SendSelectionAction.kt\n- src/main/kotlin/com/codebuff/intellij/actions/AskAboutFileAction.kt\n\n## Implementation\n```kotlin\nclass SendSelectionAction : AnAction() {\n    override fun actionPerformed(e: AnActionEvent) {\n        val editor = e.getData(CommonDataKeys.EDITOR) ?: return\n        val project = e.project ?: return\n        val selection = editor.selectionModel.selectedText ?: return\n        \n        // Open ToolWindow and add selection as context\n        val toolWindow = ToolWindowManager.getInstance(project)\n            .getToolWindow(\"Codebuff\")\n        toolWindow?.show()\n        \n        // TODO: Add selection to context in Phase 3\n    }\n    \n    override fun update(e: AnActionEvent) {\n        val editor = e.getData(CommonDataKeys.EDITOR)\n        e.presentation.isEnabled = editor?.selectionModel?.hasSelection() == true\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Actions visible in editor context menu\n- [ ] Keyboard shortcuts work\n- [ ] Actions properly enabled/disabled based on context","status":"open","priority":1,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T02:00:49.201121+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:00:49.201121+07:00","labels":["actions","editor"],"dependencies":[{"issue_id":"cb-vnl.5","depends_on_id":"cb-vnl","type":"parent-child","created_at":"2026-01-24T02:00:49.201742+07:00","created_by":"mochadwi"},{"issue_id":"cb-vnl.5","depends_on_id":"cb-vnl.11","type":"blocks","created_at":"2026-01-24T09:26:01.080321+07:00","created_by":"mochadwi"},{"issue_id":"cb-vnl.5","depends_on_id":"cb-vnl.13","type":"blocks","created_at":"2026-01-24T10:53:16.238924+07:00","created_by":"mochadwi"}]}
{"id":"cb-vnl.6","title":"Add plugin icons and resources","description":"Create plugin icons and i18n resources.\n\n## Files\n- src/main/resources/icons/codebuff.svg\n- src/main/resources/icons/codebuff_dark.svg\n- src/main/resources/messages/CodebuffBundle.properties\n- src/main/kotlin/com/codebuff/intellij/CodebuffBundle.kt\n\n## Icon Requirements\n- 13x13 for tool window\n- 16x16 for actions\n- SVG format preferred\n- Light and dark variants\n\n## Bundle\n```properties\naction.Codebuff.OpenToolWindow.text=Open Codebuff\naction.Codebuff.SendSelection.text=Ask Codebuff About Selection\ntoolwindow.title=Codebuff\nsettings.title=Codebuff Settings\n```\n\n## Acceptance Criteria\n- [ ] Icons display correctly in light/dark themes\n- [ ] All user-facing strings in bundle\n- [ ] No hardcoded strings in code","status":"open","priority":2,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":60,"created_at":"2026-01-24T02:00:49.287464+07:00","created_by":"mochadwi","updated_at":"2026-01-24T02:00:49.287464+07:00","labels":["i18n","resources"],"dependencies":[{"issue_id":"cb-vnl.6","depends_on_id":"cb-vnl","type":"parent-child","created_at":"2026-01-24T02:00:49.288106+07:00","created_by":"mochadwi"},{"issue_id":"cb-vnl.6","depends_on_id":"cb-vnl.12","type":"blocks","created_at":"2026-01-24T09:26:01.138667+07:00","created_by":"mochadwi"},{"issue_id":"cb-vnl.6","depends_on_id":"cb-vnl.13","type":"blocks","created_at":"2026-01-24T10:53:16.328413+07:00","created_by":"mochadwi"}]}
{"id":"cb-vnl.7","title":"Write tests for Gradle build configuration","description":"## TDD: Test First\n\nWrite tests to verify Gradle build configuration before implementing.\n\n## Test Cases\n\n```kotlin\nclass BuildConfigurationTest {\n    \n    @Test\n    fun `build gradle kts exists and is valid`() {\n        val buildFile = File(\"build.gradle.kts\")\n        assertTrue(buildFile.exists())\n        assertTrue(buildFile.readText().contains(\"org.jetbrains.intellij.platform\"))\n    }\n    \n    @Test\n    fun `settings gradle kts configures project name`() {\n        val settingsFile = File(\"settings.gradle.kts\")\n        assertTrue(settingsFile.exists())\n        assertTrue(settingsFile.readText().contains(\"codebuff-intellij\"))\n    }\n    \n    @Test\n    fun `gradle properties has correct JVM target`() {\n        val propsFile = File(\"gradle.properties\")\n        assertTrue(propsFile.exists())\n        val content = propsFile.readText()\n        assertTrue(content.contains(\"kotlin.jvmTarget=17\") || \n                   content.contains(\"jvmToolchain(17)\"))\n    }\n    \n    @Test\n    fun `required dependencies are configured`() {\n        val buildFile = File(\"build.gradle.kts\").readText()\n        assertTrue(buildFile.contains(\"okhttp\"))\n        assertTrue(buildFile.contains(\"kotlinx-coroutines\"))\n        assertTrue(buildFile.contains(\"gson\"))\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Test file created at src/test/kotlin/com/codebuff/intellij/BuildConfigurationTest.kt\n- [ ] Tests compile (may fail initially - RED phase)\n- [ ] Test expectations match AGENTS.md requirements","status":"in_progress","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":60,"created_at":"2026-01-24T09:21:44.370816+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:58:42.687873+07:00","labels":["setup","tdd","test"],"dependencies":[{"issue_id":"cb-vnl.7","depends_on_id":"cb-vnl","type":"parent-child","created_at":"2026-01-24T09:21:44.372038+07:00","created_by":"mochadwi"},{"issue_id":"cb-vnl.7","depends_on_id":"cb-vnl.13","type":"blocks","created_at":"2026-01-24T10:53:16.417076+07:00","created_by":"mochadwi"}]}
{"id":"cb-vnl.8","title":"Write tests for plugin.xml descriptor","description":"## TDD: Test First\n\nWrite tests to verify plugin.xml structure before implementation.\n\n## Test Cases\n\n```kotlin\nclass PluginDescriptorTest : BasePlatformTestCase() {\n    \n    @Test\n    fun `plugin xml exists in correct location`() {\n        val pluginXml = File(\"src/main/resources/META-INF/plugin.xml\")\n        assertTrue(pluginXml.exists())\n    }\n    \n    @Test\n    fun `plugin id is correctly configured`() {\n        val content = loadPluginXml()\n        assertTrue(content.contains(\"\u003cid\u003ecom.codebuff.intellij\u003c/id\u003e\"))\n    }\n    \n    @Test\n    fun `toolwindow extension is registered`() {\n        val content = loadPluginXml()\n        assertTrue(content.contains(\"toolWindow\"))\n        assertTrue(content.contains(\"Codebuff\"))\n        assertTrue(content.contains(\"CodebuffToolWindowFactory\"))\n    }\n    \n    @Test\n    fun `project services are registered`() {\n        val content = loadPluginXml()\n        assertTrue(content.contains(\"projectService\"))\n        assertTrue(content.contains(\"CodebuffProjectService\"))\n    }\n    \n    @Test\n    fun `actions are registered with shortcuts`() {\n        val content = loadPluginXml()\n        assertTrue(content.contains(\"\u003caction\"))\n        assertTrue(content.contains(\"keyboard-shortcut\"))\n    }\n    \n    private fun loadPluginXml(): String {\n        return File(\"src/main/resources/META-INF/plugin.xml\").readText()\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Test verifies all required extension points\n- [ ] Tests compile and are ready for RED phase","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":60,"created_at":"2026-01-24T09:21:44.465128+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:21:44.465128+07:00","labels":["plugin-xml","tdd","test"],"dependencies":[{"issue_id":"cb-vnl.8","depends_on_id":"cb-vnl","type":"parent-child","created_at":"2026-01-24T09:21:44.465861+07:00","created_by":"mochadwi"}]}
{"id":"cb-vnl.9","title":"Write tests for CodebuffToolWindowFactory","description":"## TDD: Test First\n\nWrite tests for ToolWindow creation before implementing.\n\n## Test Cases\n\n```kotlin\nclass CodebuffToolWindowFactoryTest : BasePlatformTestCase() {\n    \n    private lateinit var factory: CodebuffToolWindowFactory\n    \n    override fun setUp() {\n        super.setUp()\n        factory = CodebuffToolWindowFactory()\n    }\n    \n    @Test\n    fun `factory creates tool window content`() {\n        val toolWindow = mockk\u003cToolWindow\u003e()\n        val contentManager = mockk\u003cContentManager\u003e(relaxed = true)\n        every { toolWindow.contentManager } returns contentManager\n        \n        factory.createToolWindowContent(project, toolWindow)\n        \n        verify { contentManager.addContent(any()) }\n    }\n    \n    @Test\n    fun `tool window contains chat panel`() {\n        val panel = createMainPanel()\n        \n        assertNotNull(panel.findComponent\u003cChatPanel\u003e())\n    }\n    \n    @Test\n    fun `tool window contains input field`() {\n        val panel = createMainPanel()\n        \n        val inputField = panel.findComponent\u003cJTextField\u003e()\n        assertNotNull(inputField)\n    }\n    \n    @Test\n    fun `send button is present and enabled`() {\n        val panel = createMainPanel()\n        \n        val sendButton = panel.findComponent\u003cJButton\u003e { it.text == \"Send\" }\n        assertNotNull(sendButton)\n        assertTrue(sendButton!!.isEnabled)\n    }\n}\n```\n\n## Acceptance Criteria\n- [ ] Tests use IntelliJ test framework\n- [ ] Mock ToolWindow appropriately\n- [ ] Verify UI component structure","status":"open","priority":0,"issue_type":"task","owner":"moch.iqbaldc@gmail.com","estimated_minutes":90,"created_at":"2026-01-24T09:21:44.560117+07:00","created_by":"mochadwi","updated_at":"2026-01-24T09:21:44.560117+07:00","labels":["tdd","test","toolwindow","ui"],"dependencies":[{"issue_id":"cb-vnl.9","depends_on_id":"cb-vnl","type":"parent-child","created_at":"2026-01-24T09:21:44.560807+07:00","created_by":"mochadwi"}]}
